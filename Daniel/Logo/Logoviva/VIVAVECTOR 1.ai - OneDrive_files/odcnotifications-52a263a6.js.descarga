define("odsp-next/bundles/odc/Notifications",["require","exports","../../dataSources/notifications/odc/NotificationsDataSource","../../providers/notificationManager/NotificationManager","../../dataSources/notifications/odc/handlers/DeleteAll","../../dataSources/notifications/odc/handlers/FolderExpiration","../../dataSources/notifications/odc/handlers/NewReferral","../../dataSources/notifications/odc/handlers/ProcessReferral","../../dataSources/notifications/odc/handlers/RestoreAll","../../dataSources/notifications/odc/handlers/SharingAbuse"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})});define("odsp-next/dataSources/notifications/odc/NotificationsDataSource",["require","exports","tslib","@ms/odsp-utilities/lib/async/Promise","@ms/odsp-shared/lib/base/BaseModel","../../../resources/ProviderResourceKeys"],function(n,e,t,r,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=["NewReferral","ProcessReferral","SharingAbuse"],c=["DeleteAll","FolderExpiration","RestoreAll"],s=function(i){t.__extends(e,i);function e(e){var t=i.call(this,e)||this;t._bundleLoader=t.resources.consume(o.bundleLoader);return t}e.prototype.loadGlobalHandlers=function(e){for(var t=function(i){o._bundleLoader.queueLoad("odsp-next/dataSources/notifications/odc/handlers/"+i,function(){return new r.default(function(e,t){n(["odsp-next/dataSources/notifications/odc/handlers/"+i],e,t)})}).then(e).done()},o=this,i=0,s=a;i<s.length;i++){t(s[i])}};e.prototype.loadPageHandlers=function(e){for(var t=function(i){o._bundleLoader.queueLoad("odsp-next/dataSources/notifications/odc/handlers/"+i,function(){return new r.default(function(e,t){n(["odsp-next/dataSources/notifications/odc/handlers/"+i],e,t)})}).then(e).done()},o=this,i=0,s=c;i<s.length;i++){t(s[i])}};return e}(i.default);e.default=s});define("odsp-next/providers/notificationManager/NotificationManager",["require","exports","tslib","knockout","@ms/odsp-shared/lib/base/BaseModel","../../resources/ModelResourceKeys","../../resources/ProviderResourceKeys","../../resources/DataSourceResourceKeys","@ms/odsp-utilities/lib/browser/PlatformDetection.key"],function(e,t,i,n,o,r,a,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});0;var s=function(o){i.__extends(s,o);function s(e){void 0===e&&(e={});var t=o.call(this,e)||this;t._isFirstProcess=!0;if(!t.resources.consume(a.userInfo).isAuthenticated())return t;if(t.resources.consume(u.platformDetection).isMobile)return t;var i=t.resources.consume(r.userInfoStore);t._userInfo=i.getUserInfo();t._canNotify=!0;t._handlers={};t._notificationProvider=t.resources.consume(a.notification);t._notifications=t.resources.consume(c.notifications);e.isPageLevel||t._notifications.loadGlobalHandlers(t._getLoader());t.createComputed(t._computeProcessNotifications);t.createComputed(t._computeProcessTriggeredNotifications);return t}s.triggerNotification=function(e){this._triggeredNotifications.push(e)};s.prototype.createNotificationHandlers=function(e){this._canNotify&&this._notifications.loadPageHandlers(this._getLoader(e))};s.prototype._getLoader=function(n){var r=this;return function(e){for(var t=n?n(e):new(r.managed(e)),i=0,o=t.types;i<o.length;i++){var s=o[i];r._handlers[s]=t}r._isFirstProcess||r._processHandler(t)}};s.prototype._processHandler=function(e){var t=this._userInfo();if(t){for(var i={},o=0,s=e.types;o<s.length;o++){i[s[o]]=!0}if(t&&t.notifications)for(var n=0,r=t.notifications;n<r.length;n++){var a=r[n];i[a.type]&&this._shouldShowNotification(a,!1)&&this._handleNotification(a)}}};s.prototype._computeProcessNotifications=function(){var e=this._userInfo();if(e&&e.notifications){for(var t=0,i=e.notifications;t<i.length;t++){var o=i[t];this._shouldShowNotification(o,this._isFirstProcess)&&this._handleNotification(o)}this._isFirstProcess=!1}};s.prototype._computeProcessTriggeredNotifications=function(){for(var e=s._triggeredNotifications(),t=0;t<e.length;t++){var i=this._handlers[e[t]];if(i){i.showNotification(e[t]);e.splice(t--,1)}}s._triggeredNotifications(e)};s.prototype._shouldShowNotification=function(e,t){return!(!e||!e.id&&t)&&(!this._notificationProvider.handledNotifications[e.id]&&!this._isExpired(e))};s.prototype._isExpired=function(e){if(e.id&&e.expiryDateTime){var t=new Date(e.expiryDateTime);if((new Date).getTime()>t.getTime())return this._notificationProvider.handledNotifications[e.id]=!0}if(e.id&&e.expiryDate){t=new Date(e.expiryDate);if((new Date).getTime()>t.getTime()+864e5)return this._notificationProvider.handledNotifications[e.id]=!0}return!1};s.prototype._handleNotification=function(e){var t=this._handlers[e.type];if(!t)return!1;t.handleNotification(e);e.id&&(this._notificationProvider.handledNotifications[e.id]=!0);return!0};s._triggeredNotifications=n.observableArray();return s}(o.default);t.default=s});define("odsp-next/dataSources/notifications/odc/handlers/DeleteAll",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","@ms/odsp-utilities/lib/string/StringHelper","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../Notifications.resx"],function(e,t,o,i,s,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(i){o.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.types=[103];t.listenToCurrentItem=!0;t._notifications=t.resources.consume(r.notification);t._currentItem=t.resources.consume(n.currentItem);t.createComputed(t._proccessItemChanged);return t}e.prototype.handleNotification=function(e){};e.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._text||a.strings.deleteAllStatusUnknownCount})};e.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&e.taskStatus&&e.taskStatus.deleteAllCount){switch(e.taskStatus.deleteAllCount){case-1:this._text=a.strings.deleteAllStatusUnknownCount;break;case 1:this._text=s.format(a.strings.deleteAllOneItemStatus,e.taskStatus.deleteAllCount);break;default:this._text=s.format(a.strings.deleteAllStatus,e.taskStatus.deleteAllCount)}e.taskStatus.deleteAllCount=0;this.showNotification()}};return e}(i.default);t.default=c});define("odsp-next/dataSources/notifications/odc/handlers/FolderExpiration",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../actions/base/ItemCommandHelper","@ms/odsp-utilities/lib/string/StringHelper","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../../../resources/DataSourceResourceKeys","@ms/odsp-utilities/lib/logging/events/Engagement.event","../../Notifications.resx","../../../../models/item/command/FileSystemItemCommandKeys"],function(e,t,o,i,s,n,r,a,c,u,d,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f={},p=function(i){o.__extends(e,i);function e(e){void 0===e&&(e={});var t=i.call(this,e)||this;t.types=[101];t.listenToCurrentItem=!0;t._notifications=t.resources.consume(a.notification);t._currentItem=t.resources.consume(r.currentItem);t._urlDataSource=t.resources.consume(c.url);t._itemCommandHelper=new(t.managed(s.default));t.createBackgroundComputed(t._proccessItemChanged);return t}e.prototype.handleNotification=function(e){};e.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._getDetails(),severity:1,action:this._getAction(),actionText:d.strings.folderExpirationChangeSettings})};e.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&!e.isPlaceholder&&!f[e.id]&&e.dateExpires&&this._itemCommandHelper.isCommandSupported(e,l.changeExpiration)){u.Engagement.logData({name:"Notifications.FolderExpiration.View"});this.showNotification()}};e.prototype._getDetails=function(){var e=this._currentItem.peek();return n.format(d.strings.folderExpirationFormat,e.dateExpires||"")};e.prototype._getAction=function(){var e=this._currentItem.peek(),t=this._urlDataSource.getChangeFolderExpirationUrl(e.id),i=this.resources.consume(r.actionMap);return new(this.managed(i.NavigationAction))({url:t})};return e}(i.default);t.default=p});define("odsp-next/dataSources/notifications/odc/handlers/NewReferral",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ProviderResourceKeys","../../Notifications.resx","./NotificationHandlerHelper"],function(e,t,i,o,s,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(o){i.__extends(e,o);function e(e){var t=o.call(this,e)||this;t.types=[3];t._userInfoProvider=t.resources.consume(s.userInfo);t._notifications=t.resources.consume(s.notification);var i=new(t.managed(r.default));t._navigationAction=i.getStorageNavigationAction();return t}e.prototype.handleNotification=function(e){e&&this._showNotification()};e.prototype.showNotification=function(){return this._notifications.requestNotification({text:n.strings.inviteFriendNewReferral,action:this._navigationAction,actionText:n.strings.inviteFriendNewReferralButton})};e.prototype._showNotification=function(){var e=this,t=function(){e._userInfoProvider.setUserInfo(3,2,null)};this.showNotification().wait().then(t,t)};return e}(o.default);t.default=a});define("odsp-next/dataSources/notifications/odc/handlers/NotificationHandlerHelper",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ControlResourceKeys","../../../../resources/DataSourceResourceKeys"],function(e,t,i,o,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){i.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.getStorageNavigationAction=function(){var e=this.resources.consume(n.url).getManageStorageUrl()+"?biciid=superbar",t=this.resources.consume(s.actionMap);return new(this.managed(t.NavigationAction))({url:e})};return t}(o.default);t.default=r});define("odsp-next/dataSources/notifications/odc/handlers/ProcessReferral",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ProviderResourceKeys","../../Notifications.resx","./NotificationHandlerHelper","@ms/odsp-shared/lib/utilities/navigation/Navigation.key","../../../../providers/item/ItemProvider"],function(e,t,i,o,s,r,n,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(o){i.__extends(e,o);function e(e){var t=o.call(this,e)||this;t.types=[108];t._notifications=t.resources.consume(s.notification);var i=new(t.managed(n.default));t._navigationAction=i.getStorageNavigationAction();t._processUrl();return t}e.prototype.handleNotification=function(e){};e.prototype.showNotification=function(){return this._notifications.requestNotification({text:"Messages comes from server response... it will say something about user referral",action:this._navigationAction,actionText:r.strings.inviteFriendNewReferralButton})};e.prototype._processUrl=function(){var i=this,e=this.resources.consume(a.navigation),t=this.resources.consume(c.resourceKey),o=e.viewParams,s=o.invref,n=o.invsrc;if(s){t.processReferral(s,n).then(function(e){if(e.showIneligiblePopover&&e.ineligiblePopoverMessage){var t={text:e.ineligiblePopoverMessage,action:i._navigationAction,actionText:r.strings.inviteFriendIneligibleButton};i._notifications.requestNotification(t)}},function(e){});delete o.invref;delete o.invsrc}};return e}(o.default);t.default=u});define("odsp-next/dataSources/notifications/odc/handlers/RestoreAll",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","@ms/odsp-utilities/lib/string/StringHelper","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../Notifications.resx"],function(e,t,o,i,s,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(i){o.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.types=[102];t.listenToCurrentItem=!0;t._notifications=t.resources.consume(r.notification);t._currentItem=t.resources.consume(n.currentItem);t.createComputed(t._proccessItemChanged);return t}e.prototype.handleNotification=function(e){};e.prototype.showNotification=function(){return this._notifications.requestNotification({text:this._text||a.strings.restoreAllStatusUnknownCount})};e.prototype._proccessItemChanged=function(){var e=this._currentItem();if(e&&e.taskStatus&&e.taskStatus.restoreAllCount){switch(e.taskStatus.restoreAllCount){case-1:this._text=a.strings.restoreAllStatusUnknownCount;break;case 1:this._text=s.format(a.strings.restoreOneItemStatus,e.taskStatus.restoreAllCount);break;default:this._text=s.format(a.strings.restoreAllStatus,e.taskStatus.restoreAllCount)}e.taskStatus.restoreAllCount=0;this.showNotification()}};return e}(i.default);t.default=c});define("odsp-next/dataSources/notifications/odc/handlers/SharingAbuse",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","../../../../resources/ControlResourceKeys","../../../../resources/ProviderResourceKeys","../../../../resources/DataSourceResourceKeys","../../Notifications.resx"],function(e,t,o,i,s,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(i){o.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.types=[23];t._notifications=t.resources.consume(n.notification);t._createAction();return t}e.prototype.handleNotification=function(e){e&&e.param&&0<=e.param.indexOf("IsNotOwner")&&this.showNotification()};e.prototype.showNotification=function(){return this._notifications.requestNotification({text:a.strings.sharingAbuseDescription,severity:1,action:this._navigationAction,actionText:a.strings.sharingAbuseButtonText})};e.prototype._createAction=function(){var e=this.resources.consume(r.url),t=e.getOwnerId(),i=e.getSharedByUrl(t,t),o=this.resources.consume(s.actionMap);this._navigationAction=new(this.managed(o.NavigationAction))({url:i})};return e}(i.default);t.default=c});