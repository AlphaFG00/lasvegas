define("odsp-next/controls/oneUp/video/OneUpVideo",["require","exports","./OneUpVideoViewModel","../../../bindings/component/ControlBinding","./OneUpVideo.html","./OneUpVideo.css","../thumbnail/OneUpThumbnail"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.resourceKey=s.createResolvedControlDefinitionResourceKey({automationName:"od-one-up-video",name:e("module").id,template:e("./OneUpVideo.html"),viewModelType:i.default});t.default=t.resourceKey});define("odsp-next/controls/oneUp/video/OneUpVideoViewModel",["require","exports","tslib","knockout","@ms/odsp-shared/lib/utilities/knockout/ObservablesFactory","@ms/odsp-utilities/lib/browser/PlatformDetection.key","@ms/odsp-utilities/lib/logging/events/Qos.event","../../../bindings/component/ControlBinding","../ToolbarProvider.key","../../video/controls/player/VideoPlayer","../../video/resources/VideoResourceKeys","../OneUpContentViewModel","../other/commands/ItemActionBar.key","../thumbnail/OneUpThumbnail","../../../resources/DataSourceResourceKeys"],function(m,e,f,t,g,i,_,v,s,y,b,n,x,S,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(h){f.__extends(e,h);function e(e,t){var i=h.call(this,e,t)||this;i.addBindingHandlers({control:v.default});var s=i.observables,n=i.showFrame=s.pureCompute(function(){var e=i.slide.item();return!(e.video&&(e.video.height||e.video.width)||!e.audio)});i.watermark=s.pureCompute(function(){var e=n()?"audiowatermark":"videowatermark";return"undefined"==typeof __webpack_public_path__?m.toUrl("@ms/odsp-media/lib/images/itemtypes/64/"+e+".svg"):m("@ms/odsp-media/dist/media/images/itemTypes/64/"+e+".svg")});i.watermarkAlt=s.pureCompute(function(){return i.slide.item().displayName});var o=s.pureCompute(function(){var e=i.oneUp.size();return n()?{width:Math.min(200,e.width),height:Math.min(200,e.height)}:e}),a=s.pureCompute(function(){return!n}),r=g.forSingleValue(),l=s.createCallback(r);i.showWatermark=s.pureCompute(function(){return!l()||l().resultType!==_.ResultTypeEnum.Success});var d=i.slide;i.thumbnailControl=v.toSpecification(S.default,{allowError:a,showErrorActions:!1,slide:f.__assign({},d,{loadState:s.compute({read:function(){return d.loadState()},write:function(e){d.loadState.peek()<1&&d.loadState(1)}}),loadResult:l}),oneUp:i.oneUp,size:o});i._isMobile=t.platformDetection.isMobile;d.isEditCaptionEnabled(!i._isMobile);i._isPlaying=s.create(!1);i._isMaximized=s.create(!1);i.videoPlayerTagName=y.default.tagName;i.showVideo=s.pureCompute(function(){return!d.offset()});i.showThumbnail=s.pureCompute(function(){return n()||!i.showVideo()});var u=s.createCallback(r);i.scope.attach(d.loadResult.register(u));var c=d.loadState;s.backgroundCompute(function(){u()&&c(2)});var p=d.renderOptions;i.videoPlayerParams={actionBar:p?v.toSpecification(x.resourceKey,{forceExternal:!0,item:d.item}):void 0,autoplay:!p||!!p.autofocus,result:u,item:d.item,useExternalControls:!0,isPlaying:i._isPlaying,isMaximized:i._isMaximized};i.resources.expose(b.playbackPanelProvider,t.toolbarProvider);s.compute(i._computeSetIsIdleEnabledFromIsPlaying);s.compute(i._computeChangesOnMaximized);return i}e.prototype._computeSetIsIdleEnabledFromIsPlaying=function(){this.slide.isIdleEnabled(this._isPlaying())};e.prototype._computeChangesOnMaximized=function(){var e=this._isMaximized();this.oneUp.isCommandBarVisible(!e);this.slide.isEditCaptionEnabled(!this._isMobile&&!e);t.computedContext.isInitial()||this.oneUp.isInfoPaneExpanded(!1)};e.dependencies=f.__assign({},n.default.dependencies,{platformDetection:i.platformDetection,toolbarProvider:s.resourceKey,videoItemDataSource:o.videoItem});return e}(n.default);e.default=a});define("odsp-next/controls/video/controls/player/VideoPlayer",["require","exports","@ms/odsp-shared/lib/utilities/knockout/ComponentFactory","./VideoPlayerViewModel","./VideoPlayer.html","./VideoPlayer.css","../canvas/VideoCanvas","../playbackPanel/PlaybackPanel","../../../transclusion/content/TransclusionContent"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i.registerComponent({tagName:"ms-item-videoplayer",template:e("./VideoPlayer.html"),viewModel:s.default,synchronous:!0});t.default=n});define("odsp-next/controls/video/controls/player/VideoPlayerViewModel",["require","exports","tslib","@ms/odsp-shared/lib/base/ViewModel","@ms/odsp-utilities/lib/logging/events/Qos.event","../../../../bindings/component/ControlBinding","../../resources/VideoResourceKeys","../../VideoContext","../../VideoErrorType","../../../../bindings/fullScreen/FullScreenBinding","../../VideoPlaybackType"],function(e,t,n,i,o,r,l,d,u,c,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(a){n.__extends(e,a);function e(e){var t=a.call(this,e)||this;t.addBindingHandlers({control:r.default,fullScreen:c.default});var i=t,s=i.observables,n=i.resources;t.item=e.item;t._isPlaying=e.isPlaying||s.create(!1);var o=e.result;t.useExternalControls=!!e.useExternalControls;t.actionBar=s.wrap(e.actionBar);t.context=n.expose(l.context,new(t.managed(d.default))({autoplay:e.autoplay,item:t.item}));t._isMaximized=e.isMaximized;t.useExternalControls&&(t.playbackPanelProvider=n.consume(l.playbackPanelProvider));o&&t.scope.attach(o.register(s.pureCompute(t._computeResult)));s.backgroundCompute(t._computeSetIsMaximized);s.backgroundCompute(t._computeUpdateIsPlaying);return t}e.prototype.dispose=function(){this._isPlaying(!1);a.prototype.dispose.call(this)};e.prototype.onStatusClicked=function(e,t){var i=this.context.videoStatus.peek().error;if(!i||i.isRetriable){this.context.isPlaying(!0);t.stopPropagation();t.preventDefault()}return!0};e.prototype.toggleIsMaximized=function(e,t){if(this.context.shouldUseNativeControls)return!0;this.context.isMaximized(!this.context.isMaximized.peek());return!1};e.prototype.getErrorType=function(e){var t=e&&e.type||u.default.unknown;return u.default[t]};e.prototype.getErrorDetails=function(e){return e&&(e.message||u.default[e.type])||""};e.prototype._computeUpdateIsPlaying=function(){var e=this.context.isPlaying();this._isPlaying(e)};e.prototype._computeSetIsMaximized=function(){this._isMaximized(this.context.isMaximized())};e.prototype._computeResult=function(){var e=this.context;if(e.hasError()){var t=e.videoStatus().error,i={resultCode:u.default[t.type],error:t.message};switch(t.type){case u.default.unsupportedBrowser:case u.default.unsupportedCodec:case u.default.unsupportedFormat:case u.default.htmlElementSrcNotSupported:case u.default.emptyFile:return n.__assign({},i,{resultType:o.ResultTypeEnum.ExpectedFailure});default:return n.__assign({},i,{resultType:o.ResultTypeEnum.Failure})}}else if(e.canPlay()){var s=e.playbackType();return{resultType:o.ResultTypeEnum.Success,resultCode:s&&p.VideoPlaybackType[s]}}};return e}(i.default);t.default=s});define("odsp-next/controls/video/resources/VideoResourceKeys",["require","exports","@ms/odsp-utilities/lib/resources/Resources"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.context=new i.ResourceKey("video.context");t.playbackPanelProvider=new i.ResourceKey("video.playbackPanelProvider")});define("odsp-next/controls/video/VideoContext",["require","exports","tslib","knockout","@ms/odsp-utilities/lib/async/Promise","@ms/odsp-utilities/lib/string/StringHelper","@ms/odsp-utilities/lib/browser/PlatformDetection","@ms/odsp-shared/lib/base/BaseModel","@ms/odsp-shared/lib/models/store/KnockoutDataStore","@ms/odsp-utilities/lib/models/store/DataStoreCachingType","./VideoError","./VideoErrorType","./PlaybackMonitor","./VideoPlaybackType","./VideoPlayer.resx","../../utilities/flash/FlashHelper","../../utilities/features/Features","./controls/canvas/VideoCanvasType","../../resources/DataSourceResourceKeys"],function(e,t,s,n,o,a,i,r,l,d,c,p,u,h,m,f,g,_,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var y=[10,0,0],b=!1,x=!1,S=!1,k=!1,E=!1,w=0,M=!1,P=new i.default;!function(){var e=document.createElement("video");if(e&&e.canPlayType){try{e.volume=0;M=!0}catch(e){return}b=D(e,'video/mp4; codecs="avc1.42E01E, mp4a.40.2"');S=D(e,'audio/wav; codecs="1"');x=D(e,'video/webm; codecs="vp9, opus"');k=D(e,"application/vnd.apple.mpegURL")&&(P.isMac||P.isIOS);E=!(!b||!window.MediaSource&&!window.WebKitMediaSource);P.isWindows&&P.isChrome&&P.browserMajor<=34&&(E=!1);P.isSafari&&(E=!1)}}();var A=function(i){s.__extends(e,i);function e(e){var t=i.call(this,e)||this;t._videoItemDataSource=t.resources.consume(v.videoItem);t.item=e.item;t._dataStore=t.addDisposable(new l.default("VideoPlayer",d.default.local));t.itemKey=t.createPureComputed(t._computeItemKey);t.shouldAutoPlay=e.autoplay&&!P.isMobile;t.shouldUseNativeControls=t._computeShouldUseNativeControls();t.playbackType=n.observable(h.default.htmlDashling);t.url=n.observable(null);t.coverImageUrl=n.observable("");t.isLoading=n.observable(!1);t.canPlay=n.observable(!1);t.isPlaying=n.observable(t.shouldAutoPlay);t.isAdjustingVolume=n.observable(!1);t.position=n.observable(0);t.seekPercentage=n.observable(0);t.isSeeking=n.observable(!1);t.isScrubbing=n.observable(!1);t.duration=n.observable(0);t.bufferedRanges=n.observableArray();t.isMaximized=n.observable(!1);t.videoStatus=n.observable(null);t.playingQuality=n.observable(480);t.maxQuality=n.observable(720);t.dashling=n.observable();0;g.isFeatureEnabled(g.AllowVideoDiagnostics)&&(t.canShowDiagnostics=!0);t.isMuted=n.observable(!1);t._dataStore.persistBoolean(t.isMuted,"isMuted");t.volume=n.observable(1);t._dataStore.persistNumber(t.volume,"volume");t.desiredQuality=n.observable(480);t._dataStore.persistNumber(t.desiredQuality,"desiredQuality");t.isABREnabled=n.observable(!0);t._dataStore.persistBoolean(t.isABREnabled,"isABREnabled");t.isDiagnosticsEnabled=n.observable(!1);t._dataStore.persistBoolean(t.isDiagnosticsEnabled,"isDiagnosticsEnabled");t.hasError=t.createPureComputed(t._computeHasError);t.canvasType=t.createPureComputed(t._computeCanvasType);t.canAdjustQuality=t.createPureComputed(t._computeCanAdjustQuality);t.subscribe(t.item,t._onItemChanged);t.subscribe(t.isAdjustingVolume,t._onIsAdjustingVolumeChanged);t.subscribe(t.isPlaying,t._onIsPlayingChanged);t._onItemChanged(t.item.peek());new(t.managed(u.default))({context:t});return t}e.prototype.setVideoStatus=function(e){var t=e.statusMessage,i=e.error;this.isLoading(!1);this.isPlaying(!1);this.canPlay(!1);this.videoStatus({isVisible:!0,statusMessage:t,error:i});if((!i||i.isRetriable)&&!this.isSeeking.peek()&&this.duration.peek()){var s=this.duration.peek(),n=s?this.position.peek()/s:0;this.seekPercentage(n);this.isSeeking(!0)}};e.prototype.preprocessRequest=function(e){return this._videoItemDataSource.preprocessRequest(this.item.peek(),e)};e.prototype._cancelGetDownload=function(){if(this._pendingGetDownloadPromise){this._pendingGetDownloadPromise.cancel();this._pendingGetDownloadPromise=null}};e.prototype._onIsPlayingChanged=function(e){var t=this,i=this.videoStatus.peek();if(e&&i.isVisible){var s=this.url.peek(),n=i.error;this.url(null);n&&n.requiresNewUrl?this._getNewDownloadUrl().done(function(e){t._reset(e,!0)}):this._reset(s,!0)}};e.prototype._computeItemKey=function(){var e=this.item();return e?e.key:null};e.prototype._computeHasError=function(){return this.videoStatus().isVisible};e.prototype._computeCanAdjustQuality=function(){return this.playbackType()===h.default.htmlDashling};e.prototype._computeShouldUseNativeControls=function(){return P.isIOS};e.prototype._computeCanvasType=function(){switch(this.playbackType()){case h.default.flashDash:case h.default.flashMp4:return _.default.flash;default:return _.default.html}};e.prototype._onItemChanged=function(e){if(e&&this._lastItemKey!==e.key){this._lastItemKey=e.key;this._reset(null);this._evaluateItemPlayability()}};e.prototype._reset=function(e,t){var i=this.item(),s=i&&i.thumbnail,n=null;s&&(n=a.format(s.url,s.width,s.height));this._cancelGetDownload();this.coverImageUrl(n);this.videoStatus({isVisible:!1});this.isLoading(!0);this.canPlay(!1);if(!t){this.isSeeking(!1);this.seekPercentage(0);this.position(0);this.duration(0)}this.url(e);this.shouldAutoPlay&&this.isPlaying(!0)};e.prototype._onIsAdjustingVolumeChanged=function(e){e&&this.isMuted(!1)};e.prototype._evaluateItemPlayability=function(){var t=this,e=this.item(),i=!(!e||e.did||!(e.video||g.isFeatureEnabled(g.EnableAudioPlayer)&&e.audio)),s=null,n=this.videoStatus(),o=e&&0===e.size,a=n.error,r=!a||a.isRetriable;if(!n.isVisible||r)if(o)this.setVideoStatus({statusMessage:m.strings.errorEmptyFile,error:new c.default("",{type:p.default.emptyFile,isRetriable:!1})});else if(i){if(M){var l=this._canPlayAsNativeMp4(e),d=this._shouldPreferNative(e),u=this._videoItemDataSource.isStreamingSupported(e);if(l&&d)s=h.default.htmlMp4;else if(u&&E)s=h.default.htmlDashling;else if(u&&k&&this._videoItemDataSource.isHlsPlaybackSupported())s=h.default.htmlHls;else{if(u&&0===w){this._evaluateFlashSupport();return}if(u&&1===w)return;s=u&&2===w?h.default.flashDash:l?h.default.htmlMp4:h.default.htmlFallback}}if(s){this.playbackType(s);this._getNewDownloadUrl().done(function(e){t._reset(e)})}else this.setVideoStatus({statusMessage:m.strings.errorUnsupportedBrowser,error:new c.default("",{type:p.default.unsupportedBrowser,isRetriable:!1})})}else e&&!e.isPlaceholder&&this.setVideoStatus({statusMessage:m.strings.errorUnsupportedFormat,error:new c.default("",{type:p.default.unsupportedFormat,isRetriable:!1})});else this.playbackType(h.default.none)};e.prototype._evaluateFlashSupport=function(){var t=this;w=1;f.default.checkFlashSupport(y,function(e){if(!t.isDisposed){w=e?2:3;t._evaluateItemPlayability()}})};e.prototype._shouldPreferNative=function(e){var t=e.video,i=(void 0===t?{}:t).bitrate,s=void 0===i?void 0:i,n=(e.extension||"").toLowerCase();return!(!e.audio||".mp3"!==n)||(!!(s&&s<=3e6)||!s&&".mp4"===e.extension&&e.size<=5242880)};e.prototype._canPlayAsNativeMp4=function(e){var t=(e.extension||"").toLowerCase();if(e.audio&&".mp3"===t)return!0;if(x&&".webm"===t)return!0;var i=e?e.video:null;return i&&"H264"===i.fourCC&&b&&("PCM"!==i.audioFormat||S)};e.prototype._getNewDownloadUrl=function(){var t=this;if(this._pendingGetDownloadPromise)return this._pendingGetDownloadPromise;var e=this._videoItemDataSource.getDownloadUrl(this.item.peek(),this.playbackType.peek());this._pendingGetDownloadPromise=this.trackPromise(e);return this._pendingGetDownloadPromise.then(function(e){t._pendingGetDownloadPromise=null;return e},function(e){t._pendingGetDownloadPromise=null;o.default.isCanceled(e)||t.setVideoStatus({statusMessage:m.strings.errorLoading,error:new c.default(e.message,{type:p.default.getDownloadUrlFailure,isRetriable:!1,requiresNewUrl:!0})});return o.default.wrapError(e)})};return e}(r.default);t.default=A;function D(e,t){try{var i=e.canPlayType(t);return i&&"no"!==i.toLowerCase()}catch(e){return!1}}});define("@ms/odsp-shared/lib/models/store/KnockoutDataStore",["require","exports","tslib","@ms/odsp-utilities/lib/models/store/DataStoreCachingType","@ms/odsp-utilities/lib/models/store/BaseDataStore","../../base/BaseModel"],function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(s){i.__extends(e,s);function e(e,t){void 0===t&&(t=n.default.none);var i=s.call(this)||this;i.dataStore=new o.default(e,t);return i}e.prototype.persistBoolean=function(e,t){var i=this,s=this.getValue(t);void 0!==s&&e("true"===s);this.subscribe(e,function(e){return i.setValue(t,String(e))})};e.prototype.persistNumber=function(e,t){var i=this,s=this.getValue(t);void 0!==s&&e(Number(s));this.subscribe(e,function(e){return i.setValue(t,String(e))})};e.prototype.persistString=function(e,t){var i=this,s=this.getValue(t);void 0!==s&&e(s);this.subscribe(e,function(e){return i.setValue(t,e)})};e.prototype.setValue=function(e,t,i){this.dataStore.setValue(e,t,i)};e.prototype.getValue=function(e,t){return this.dataStore.getValue(e,t)};e.prototype.remove=function(e,t){this.dataStore.remove(e,t)};return e}(s.default);t.default=a});define("odsp-next/controls/video/VideoError",["require","exports","tslib","./VideoErrorType"],function(e,t,i,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(c){i.__extends(e,c);function e(e,t){void 0===t&&(t={});var i=c.call(this,e)||this,s=t.type,n=void 0===s?p.default.unknown:s,o=t.isRetriable,a=void 0===o||o,r=t.requiresNewUrl,l=void 0!==r&&r,d=t.stack,u=t.data;i.message=e;i.type=n;i.isRetriable=a;i.requiresNewUrl=l;d&&(i.stack=d);u&&(i.data=u);return i}return e}(Error);t.VideoError=s;t.default=s});define("odsp-next/controls/video/VideoErrorType",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i;!function(e){e[e.none=0]="none";e[e.unknown=1]="unknown";e[e.unsupportedFormat=2]="unsupportedFormat";e[e.unsupportedBrowser=3]="unsupportedBrowser";e[e.getDownloadUrlFailure=4]="getDownloadUrlFailure";e[e.htmlElementDecode=5]="htmlElementDecode";e[e.htmlElementNetwork=6]="htmlElementNetwork";e[e.htmlElementAborted=7]="htmlElementAborted";e[e.htmlElementSrcNotSupported=8]="htmlElementSrcNotSupported";e[e.htmlElementOther=9]="htmlElementOther";e[e.htmlDashlingMediaSourceInit=10]="htmlDashlingMediaSourceInit";e[e.htmlDashlingManifestDownload=11]="htmlDashlingManifestDownload";e[e.htmlDashlingInitSegmentDownload=12]="htmlDashlingInitSegmentDownload";e[e.htmlDashlingMediaSegmentDownload=13]="htmlDashlingMediaSegmentDownload";e[e.htmlDashlingManifestParse=14]="htmlDashlingManifestParse";e[e.htmlDashlingVideoElementError=15]="htmlDashlingVideoElementError";e[e.htmlDashlingSourceBufferInit=16]="htmlDashlingSourceBufferInit";e[e.htmlDashlingSourceBufferAppendException=17]="htmlDashlingSourceBufferAppendException";e[e.htmlDashlingSourceBufferAppendMissing=18]="htmlDashlingSourceBufferAppendMissing";e[e.htmlDashlingOther=19]="htmlDashlingOther";e[e.htmlOther=20]="htmlOther";e[e.flashLoadTimeout=21]="flashLoadTimeout";e[e.flashOther=22]="flashOther";e[e.throttled=23]="throttled";e[e.unsupportedCodec=24]="unsupportedCodec";e[e.emptyFile=25]="emptyFile";e[e.bitRateTooHigh=26]="bitRateTooHigh"}(i=t.VideoErrorType||(t.VideoErrorType={}));t.default=i});define("odsp-next/controls/video/PlaybackMonitor",["require","exports","tslib","@ms/odsp-shared/lib/base/BaseModel","@ms/odsp-utilities/lib/logging/events/Qos.event","./logging/VideoLoad.event","./logging/VideoSession.event","./logging/VideoSessionEndReason"],function(e,t,n,i,c,o,a,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=0,s=function(s){n.__extends(e,s);function e(e){var t=s.call(this,e)||this,i=e.context;t._context=i;t.createComputed(t._computeResetInstance);t.createBackgroundComputed(t._computeReportLoad).extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}});t.createBackgroundComputed(t._computeReportSession).extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}});return t}e.prototype.dispose=function(){this._loadEvent&&this._reportLoadEnd({isDisposed:!0});this._sessionEvent&&this._reportSessionEnd({isDisposed:!0});s.prototype.dispose.call(this)};e.prototype._computeResetInstance=function(){this._context.itemKey();this._instanceNumber=++r;this._loadSequenceNumber=0;this._sessionSequenceNumber=0};e.prototype._computeReportLoad=function(){this._loadEvent?this._context.isLoading()||this._reportLoadEnd():this._context.isLoading()&&this._reportLoadStart()};e.prototype._computeReportSession=function(){this._sessionEvent?this._context.isPlaying()||this._reportSessionEnd():this._context.isPlaying()&&this._reportSessionStart()};e.prototype._reportLoadStart=function(){var e=this._context.item.peek(),t=e.audio,i=e.video;this._loadEvent=new o.default(n.__assign({name:"Video.Load",playbackType:this._context.playbackType.peek(),fileExtension:(e.extension||"").toLowerCase(),fileDuration:(i||t).duration},i?{fileBitrate:i.bitrate,width:i.width,height:i.height,audioFormat:i.audioFormat,fourCC:i.fourCC}:{},{instance:this._instanceNumber,sequence:this._loadSequenceNumber}));this._loadSequenceNumber++};e.prototype._reportLoadEnd=function(e){var t,i=(void 0===e?{}:e).isDisposed,s=void 0!==i&&i,n=this._context.videoStatus.peek(),o=n.error,a=o&&o.type,r=o&&o.message,l=o&&o.stack,d=o&&o.data;t=s?c.ResultTypeEnum.ExpectedFailure:n.isVisible?c.ResultTypeEnum.Failure:c.ResultTypeEnum.Success;this._loadEvent.end({resultType:t,errorType:a,errorMessage:r,extraData:{VideoError_stack:l,VideoError_data:d}});this._loadEvent=null};e.prototype._reportSessionStart=function(){var e=this._context.item.peek(),t=e.audio,i=e.video;this._sessionEvent=new a.default(n.__assign({name:"Video.Session",playbackType:this._context.playbackType.peek(),fileExtension:(e.extension||"").toLowerCase(),fileDuration:(i||t).duration},i?{fileBitrate:i.bitrate,cameraMake:i.cameraMake,cameraModel:i.cameraModel,width:i.width,height:i.height,audioFormat:i.audioFormat,fourCC:i.fourCC}:{},{quality:this._context.playingQuality.peek(),maxQuality:this._context.maxQuality.peek(),instance:this._instanceNumber,sequence:this._sessionSequenceNumber}));this._sessionSequenceNumber++};e.prototype._reportSessionEnd=function(e){var t,i,s=(void 0===e?{}:e).isDisposed,n=void 0!==s&&s,o=this._context.videoStatus.peek(),a=o.error,r=a&&a.message,l=a&&a.type,d=a&&a.stack,u=a&&a.data;t=n?c.ResultTypeEnum.ExpectedFailure:o.isVisible?c.ResultTypeEnum.Failure:c.ResultTypeEnum.Success;i=n?p.default.closed:o.isVisible?p.default.failed:.99<this._context.position.peek()/this._context.duration.peek()?p.default.ended:this._context.isPlaying.peek()?p.default.unknown:p.default.paused;this._sessionEvent.end({resultType:t,errorType:l,endReason:i,errorMessage:r,extraData:{VideoError_stack:d,VideoError_data:u}});this._sessionEvent=null};return e}(i.default);t.default=s});define("odsp-next/controls/video/logging/VideoLoad.event",["require","exports","@ms/odsp-utilities/lib/logging/PairedEventBase","@ms/odsp-utilities/lib/logging/events/Qos.event","../VideoPlaybackType","../VideoErrorType","@ms/odsp-utilities/lib/logging/events/ResultTypeEnum"],function(e,t,i,s,n,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VideoPlaybackType=n.VideoPlaybackType;t.VideoErrorType=o.VideoErrorType;t.ResultTypeEnum=a.ResultTypeEnum;t.VideoLoad=i.createPairedEvent({eventName:"VideoLoad,Qos,",shortEventName:"VideoLoad"},{playbackType:{typeRef:n.VideoPlaybackType,type:6},errorType:{typeRef:o.VideoErrorType,type:6},errorMessage:1,sequence:2,instance:2,fileExtension:1,fileDuration:2,fileBitrate:2,width:2,height:2,fourCC:1,audioFormat:1},s.Qos);t.default=t.VideoLoad});define("odsp-next/controls/video/VideoPlaybackType",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i;!function(e){e[e.none=0]="none";e[e.flashDash=1]="flashDash";e[e.flashMp4=2]="flashMp4";e[e.htmlMp4=3]="htmlMp4";e[e.htmlDashling=4]="htmlDashling";e[e.htmlHls=5]="htmlHls";e[e.htmlFallback=6]="htmlFallback"}(i=t.VideoPlaybackType||(t.VideoPlaybackType={}));t.default=i});define("odsp-next/controls/video/logging/VideoSession.event",["require","exports","@ms/odsp-utilities/lib/logging/PairedEventBase","@ms/odsp-utilities/lib/logging/events/Qos.event","../VideoPlaybackType","../VideoErrorType","./VideoSessionEndReason","@ms/odsp-utilities/lib/logging/events/ResultTypeEnum"],function(e,t,i,s,n,o,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.VideoPlaybackType=n.VideoPlaybackType;t.VideoErrorType=o.VideoErrorType;t.VideoSessionEndReason=a.VideoSessionEndReason;t.ResultTypeEnum=r.ResultTypeEnum;t.VideoSession=i.createPairedEvent({eventName:"VideoSession,Qos,",shortEventName:"VideoSession"},{playbackType:{typeRef:n.VideoPlaybackType,type:6},errorType:{typeRef:o.VideoErrorType,type:6},errorMessage:1,sequence:2,instance:2,fileExtension:1,fileDuration:2,fileBitrate:2,cameraMake:1,cameraModel:1,quality:2,maxQuality:2,width:2,height:2,fourCC:1,audioFormat:1,endReason:{typeRef:a.VideoSessionEndReason,type:6}},s.Qos);t.default=t.VideoSession});define("odsp-next/controls/video/logging/VideoSessionEndReason",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i;!function(e){e[e.unknown=0]="unknown";e[e.closed=1]="closed";e[e.paused=2]="paused";e[e.ended=3]="ended";e[e.failed=4]="failed"}(i=t.VideoSessionEndReason||(t.VideoSessionEndReason={}));t.default=i});define("odsp-next/utilities/flash/FlashHelper",["require","exports","@ms/odsp-utilities/lib/domUtils/DomUtils","@ms/odsp-utilities/lib/logging/ErrorHelper"],function(e,t,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u,i=function(){function r(){}r.checkFlashSupport=function(e,t){u?t(r._isVersionAcceptable(e)):r._evaluateFlash(e,t)};r._evaluateFlash=function(i,t){var s,n=10,o=document.body;if(window.ActiveXObject)try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");u=e?r._parseVersionString(e.Getletiable("$version")):[]}catch(e){u=[]}finally{a(r._isVersionAcceptable(i))}else{(s=l.default.ce("OBJECT")).style.position="absolute";s.style.left="99999px";s.setAttribute("type","application/x-shockwave-flash");o.appendChild(s);!function e(){var t;try{t=s.GetVariable("$version")}catch(e){}if(t){u=r._parseVersionString(t);a(r._isVersionAcceptable(i))}else if(0<n){n--;setTimeout(e,10)}else{o.removeChild(s);a(!(u=[]))}}()}function a(e){try{t(e)}catch(e){d.default.log(e)}}};r._parseVersionString=function(e){var t=(e||"").split(" "),i=1<t.length?t[1].split(","):"";return 2<i.length?[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]:[]};r._isVersionAcceptable=function(e){return!(!e||3!==e.length||3!==u.length||!(u[0]>e[0]||u[0]===e[0]&&u[1]>e[1]||u[0]===e[0]&&u[1]===e[1]&&u[2]>=e[2]))};return r}();t.default=i});define("odsp-next/controls/video/controls/canvas/VideoCanvasType",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}e.flash="flash";e.html="html";return e}();t.default=i});define("odsp-next/bindings/fullScreen/FullScreenBinding",["require","exports","tslib","knockout","@ms/odsp-shared/lib/bindings/base/BaseBinding","../../utilities/ui/FullScreen"],function(e,t,s,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(i){s.__extends(e,i);function e(e){var t=i.call(this,e)||this;t._isMaximized=e.valueAccessor()||n.observable(!1);t.events.on(document,"fullscreenchange, webkitfullscreenchange, mozfullscreenchange, MSFullscreenChange",t._onFullScreenChanged);t.subscribe(t._isMaximized,t._onIsMaximizedChanged);return t}e.prototype._onIsMaximizedChanged=function(e){e?o.default.enterFullScreen():o.default.exitFullScreen()};e.prototype._onFullScreenChanged=function(){this._isMaximized(o.default.isFullScreen())};return e}(i.default);t.default=a});define("odsp-next/controls/video/controls/player/VideoPlayer.html",[],function(){return"<div class=od-VideoPlayer data-bind=\"fullScreen: context.isMaximized, css: { 'od-VideoPlayer--isFullScreen': context.isMaximized, 'od-VideoPlayer--hasControls': !useExternalControls && !context.shouldUseNativeControls, 'od-VideoPlayer--hasStatus': context.videoStatus().isVisible }\"><div class=od-VideoPlayer-canvas data-bind=\"event: { dblclick: toggleIsMaximized }, component: { name: 'od-videocanvas' }\"></div><div class=od-VideoPlayer-status data-bind=\"click: onStatusClicked\"><div class=od-VideoPlayer-statusContent>\x3c!--ko if: $component.context.videoStatus().isRetriable--\x3e<button class=\"od-VideoPlayer-statusButton ms-Icon\" data-bind=\"icon: true, css: { 'ms-Icon--Sync': context.hasError(), 'ms-Icon--Play': !context.hasError() && !context.isPlaying(), 'ms-Icon--Pause': !context.hasError() && context.isPlaying() }\"></button>\x3c!--/ko--\x3e\x3c!--ko with: $component.context.videoStatus--\x3e\x3c!--ko if: $data.statusMessage--\x3e<div class=od-VideoPlayer-statusText data-bind=\"text: $data.statusMessage\"></div>\x3c!--/ko--\x3e\x3c!--ko if: $component.context.canShowDiagnostics--\x3e<div class=od-VideoPlayer-debugText><strong data-bind=\"text: $component.getErrorType($data.error)\"></strong> <span data-bind=\"text: $component.getErrorDetails($data.error)\"></span></div>\x3c!--/ko--\x3e\x3c!--/ko--\x3e\x3c!--ko if: context.hasError()--\x3e\x3c!--ko control: actionBar--\x3e\x3c!--/ko--\x3e\x3c!--/ko--\x3e</div></div>\x3c!--ko if: !context.shouldUseNativeControls--\x3e\x3c!--ko if: useExternalControls--\x3e\x3c!--ko component: {\r\n name: 'od-transclusion-content',\r\n params: {\r\n provider: playbackPanelProvider\r\n }\r\n }--\x3e\x3c!--ko component: { name: 'od-playback-panel' }--\x3e\x3c!--/ko--\x3e\x3c!--/ko--\x3e\x3c!--/ko--\x3e\x3c!--ko ifnot: useExternalControls--\x3e<div class=od-VideoPlayer-controls data-bind=\"component: { name: 'od-playback-panel' }\"></div>\x3c!--/ko--\x3e\x3c!--/ko--\x3e</div>"});define("odsp-next/controls/video/controls/player/VideoPlayer.css",["@microsoft/load-themed-styles","odsp-next/providers/theming/ThemeInitializer"],function(e,t){e.loadStyles([{rawString:".od-VideoPlayer--isFullScreen{position:fixed;left:0;top:0;width:100%;height:100%;background:"},{theme:"black",defaultValue:"#000000"},{rawString:"}.od-VideoPlayer-frame{border:none;height:100%;width:100%}.od-VideoPlayer-canvas,.od-VideoPlayer-status{position:absolute;top:0;left:0;right:0;bottom:0}.od-VideoPlayer-status{background-color:rgba(0,0,0,.8);color:"},{theme:"white",defaultValue:"#ffffff"},{rawString:";text-align:center;display:none}.od-VideoPlayer-status .od-VideoPlayer-statusContent .od-ButtonBar-main{float:none}.od-VideoPlayer-statusContent{position:absolute;top:50%;left:50%;right:-50%;-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%);padding:20px}.od-VideoPlayer--hasStatus .od-VideoPlayer-status{display:block}.od-VideoPlayer-debugText{color:"},{theme:"neutralTertiary",defaultValue:"#a6a6a6"},{rawString:";font-size:11px;padding:20px 0}.od-VideoPlayer-statusButton{width:100px;height:100px;line-height:100px;vertical-align:middle;padding:0;margin:20px;border:2px solid "},{theme:"white",defaultValue:"#ffffff"},{rawString:";border-radius:50%;box-sizing:border-box;font-size:75px;color:"},{theme:"white",defaultValue:"#ffffff"},{rawString:";background-color:rgba(0,0,0,.5);cursor:pointer}.od-VideoPlayer-statusButton:before{font-size:42px;display:block}.od-VideoPlayer-statusButton:hover{background-color:"},{theme:"neutralSecondaryAlt",defaultValue:"#767676"},{rawString:"}.od-VideoPlayer-statusButton:active{background-color:"},{theme:"white",defaultValue:"#ffffff"},{rawString:";border-color:"},{theme:"black",defaultValue:"#000000"},{rawString:";color:"},{theme:"black",defaultValue:"#000000"},{rawString:"}.od-VideoPlayer .od-VideoCanvas-video{position:absolute;left:0;top:0;width:100%;height:100%}.od-VideoPlayer-controls{position:absolute;top:0;right:0;bottom:0;background-color:rgba(0,0,0,.5)}"}])});define("odsp-next/controls/video/controls/canvas/VideoCanvas",["require","exports","@ms/odsp-shared/lib/utilities/knockout/ComponentFactory","./VideoCanvasViewModel","./VideoCanvas.css","./VideoCanvas.html"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i.registerComponent({tagName:"od-videocanvas",template:e("./VideoCanvas.html"),viewModel:s.default,synchronous:!0});t.default=n});define("odsp-next/controls/video/controls/canvas/VideoCanvasViewModel",["require","exports","tslib","@ms/odsp-shared/lib/base/ViewModel","./HtmlVideoContextBinding","./FlashVideoContextBinding","./VideoMonitorBinding","../../resources/VideoResourceKeys"],function(e,t,s,i,n,o,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(i){s.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.context=t.resources.consume(r.context);t.addBindingHandlers({htmlVideoContext:n.default,flashVideoContext:o.default,videoMonitor:a.default});return t}return e}(i.default);t.default=l});define("odsp-next/controls/video/controls/canvas/HtmlVideoContextBinding",["require","exports","tslib","knockout","@ms/odsp-shared/lib/bindings/base/BaseBinding","../../VideoPlayer.resx","../../../../resources/DataSourceResourceKeys","../../VideoError","@ms/dashling/dist/amd/Dashling","@ms/dashling/dist/amd/DashlingEnums","../../VideoPlaybackType","../../VideoErrorType"],function(e,t,i,d,s,c,n,p,o,h,a,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="video",l=function(s){i.__extends(e,s);function e(e){var t=s.call(this,e)||this;t.controlsDescendantBindings=!0;t._videoItemDataSource=t.resources.consume(n.videoItem);var i=t._context=t.valueAccessor();t.subscribe(i.url,t._onUrlChanged);t.createBackgroundComputed(t._computeVolume);t.createBackgroundComputed(t._computeIsMuted);t.subscribe(i.seekPercentage,t.async.debounce(t._onSeekPercentageChanged,100));t.subscribe(i.isScrubbing,t._onIsScrubbingChanged);t.subscribe(i.desiredQuality,t._onDesiredQualityChanged);t.subscribe(i.isABREnabled,t._onIsABREnabledChanged);t.subscribe(i.isPlaying,t._onIsPlayingChanged);t._onUrlChanged(i.url());t._onIsPlayingChanged(i.isPlaying.peek());return t}e.prototype.dispose=function(){this._disposeVideo();s.prototype.dispose.call(this)};e.prototype._disposeVideo=function(){if(this._dashling){this._context.dashling(null);this._dashling.dispose();this._dashling=null}var e=this._videoElement;if(e){this.events.off(e);try{e.pause();this.element.removeChild(e)}catch(e){}delete this._videoElement}};e.prototype._onUrlChanged=function(e){var t=this;this._disposeVideo();if(e){var i=this._videoElement=document.createElement("video");this.events.onAll(i,{loadstart:this._handleLoadStart,canplay:this._handleCanPlay,error:this._handleVideoElementError,ended:this._handleEnded,volumechange:this._handleVolumeChanged,play:this._handlePlay,pause:this._handlePause,waiting:this._handleWaiting,playing:this._handlePlaying});i.className="od-VideoCanvas-video";if(this._context.shouldUseNativeControls){this.events.on(i,"loadedmetadata",this._handleCanPlay);i.setAttribute("controls","");i.setAttribute("poster",this._context.coverImageUrl.peek()||"");i.setAttribute("preload","metadata")}else this._context.shouldAutoPlay&&i.setAttribute("autoplay","autoplay");this._context.playbackType()===a.default.htmlDashling?this.async.setTimeout(function(){t._initializeDashling()},0):i.setAttribute("src",e);this._computeVolume();this._computeIsMuted();this.element.appendChild(i);this._checkPlayState(!0)}};e.prototype._convertDesiredQualityToVideoIndex=function(e){switch(e){case 1080:return 4;case 720:return 3;case 480:return 2;case 360:return 1;default:return 0}};e.prototype._initializeDashling=function(){var e=this._videoElement;if(e){var t=this._dashling=new o.default;t.settings.isABREnabled=this._context.isABREnabled();t.settings.targetQuality.audio=1;t.settings.targetQuality.video=this._convertDesiredQualityToVideoIndex(this._context.desiredQuality());t.settings.preprocessRequest=this._context.preprocessRequest.bind(this._context);this._manifestQualityMap=null;this._context.isSeeking()&&this._context.duration()&&(t.settings.startTime=this._context.duration()*this._context.seekPercentage());t.load(e,this._context.url());this._context.dashling(t)}};e.prototype._onIsPlayingChanged=function(e){this._checkPlayState();if(e)this._updatePlaybackStateId||(this._updatePlaybackStateId=this.async.setInterval(this._updatePlaybackState,100));else{this.async.clearInterval(this._updatePlaybackStateId);delete this._updatePlaybackStateId}};e.prototype._onDesiredQualityChanged=function(e){var t=this._getManifestVideoQualities();if(t){this._dashling.settings.targetQuality[r]=t.indexOf(e);this._dashling.settings.isABREnabled=!1;this._dashling.resetStreams()}};e.prototype._onIsABREnabledChanged=function(e){this._dashling&&(this._dashling.settings.isABREnabled=e)};e.prototype._computeVolume=function(){var e=this._context.volume(),t=this._videoElement;t&&(t.volume=e)};e.prototype._computeIsMuted=function(){var e=this._context.isMuted(),t=this._videoElement;t&&(t.muted=e)};e.prototype._onSeekPercentageChanged=function(e){var t=this._videoElement;if(t&&t.duration&&!this._context.videoStatus().isVisible){t.currentTime=e?e*t.duration:0;this._context.isSeeking(!0)}};e.prototype._onIsScrubbingChanged=function(e){this._onSeekPercentageChanged(this._context.seekPercentage());var t=this._videoElement;!e&&t&&this._context.position(t.currentTime)};e.prototype._handleLoadStart=function(e){this._context.isLoading(!0)};e.prototype._handleCanPlay=function(e){this._context.canPlay(!0)};e.prototype._handleVideoElementError=function(){var e,t,i,s=c.strings.errorLoading,n=m.default.htmlOther,o=!0,a=!1,r=this._videoElement,l=this._dashling;if(r&&r.error){switch(r.error.code){case 3:n=m.default.htmlElementDecode;s=c.strings.errorDecode;o=!1;break;case 2:n=m.default.htmlElementNetwork;s=c.strings.errorNetwork;break;case 4:n=m.default.htmlElementSrcNotSupported;s=c.strings.errorUnsupportedBrowser;break;case 1:n=m.default.htmlElementAborted;return;default:n=m.default.htmlElementOther}}else if(l&&l.state===h.DashlingSessionState.error){e=l.lastError;if(l.lastErrorMessage instanceof Error){var d=l.lastErrorMessage;e=""+d.message;t=d.stack;d.data&&(i=d.data)}else l.lastErrorMessage&&(e=l.lastErrorMessage);var u=this._videoItemDataSource.getErrorType(l.lastErrorType,e);if(u!==m.default.unknown)(n=u)===m.default.throttled?s=c.strings.throttledErrorMessage:n===m.default.unsupportedCodec?s=c.strings.unsupportedCodecErrorMessage:n===m.default.bitRateTooHigh&&(s=c.strings.bitRateTooHighErrorMessage);else switch(l.lastErrorType){case h.DashlingError.initSegmentDownload:n=m.default.htmlDashlingInitSegmentDownload;break;case h.DashlingError.manifestDownload:n=m.default.htmlDashlingManifestDownload;a=!0;break;case h.DashlingError.manifestParse:n=m.default.htmlDashlingManifestParse;break;case h.DashlingError.mediaSegmentDownload:n=m.default.htmlDashlingMediaSegmentDownload;a=!0;break;case h.DashlingError.mediaSourceInit:n=m.default.htmlDashlingMediaSourceInit;break;case h.DashlingError.sourceBufferAppendException:n=m.default.htmlDashlingSourceBufferAppendException;break;case h.DashlingError.sourceBufferAppendMissing:n=m.default.htmlDashlingSourceBufferAppendMissing;break;case h.DashlingError.sourceBufferInit:n=m.default.htmlDashlingSourceBufferInit;break;case h.DashlingError.videoElementError:n=m.default.htmlDashlingVideoElementError;break;default:n=m.default.htmlDashlingOther}}this._context.setVideoStatus({statusMessage:s,error:new p.default(e||m.default[n],{type:n,isRetriable:o,requiresNewUrl:a,stack:t,data:i})})};e.prototype._checkPlayState=function(e){var t=this,i=this._videoElement,s=!1,n=this._context;(e=e||!n.canPlay())||(this._stalePlayStateId=0);if(i){if(n.isPlaying()&&!n.isScrubbing()&&i.paused)if(e)s=!0;else{Math.abs(n.position()-n.duration())<.5&&(i.currentTime=0);i.play()}else n.isPlaying()&&!n.isScrubbing()||i.paused||(e?s=!0:i.pause());s&&!this._stalePlayStateId&&(this._stalePlayStateId=this.async.setTimeout(function(){t._stalePlayStateId=0;t._checkPlayState()},300))}};e.prototype._checkEndState=function(e){var t=this._videoElement,i=this._context;e||(this._staleEndStateId=0);if(t&&(!e||i.isPlaying())&&t.duration-t.currentTime<=.4)if(e)this._staleEndStateId||(this._staleEndStateId=this.async.setTimeout(this._checkEndState,400));else{i.position(i.duration());this._handleEnded(null)}};e.prototype._updatePlaybackState=function(){var e=this._videoElement;if(e){var t=e.buffered,i=e.duration,s=this._context.bufferedRanges;this._checkPlayState(!0);this._checkEndState(!0);this._context.position(e.currentTime);this._context.duration(e.duration);if(i&&t){for(;s().length>t.length;)s.pop();for(var n=0;t&&n<t.length;n++){var o=s()[n],a=t.start(n),r=100*a/i+"%",l=100*(t.end(n)-a)/i+"%";if(o){o.left(r);o.width(l)}else s.push({left:d.observable(r),width:d.observable(l)})}}this._dashling&&this._updateDashlingState()}};e.prototype._getManifestVideoQualities=function(){if(!this._manifestQualityMap){var e=this._dashling,t=e?e.settings:null,i=t?t.manifest:null;i&&i.streams&&i.streams[r]&&i.streams[r].qualities&&(this._manifestQualityMap=e.settings.manifest.streams[r].qualities.map(function(e){var t=e.id;return parseInt(/\D*(\d+)p/.exec(void 0===t?"":t)[1],10)}).filter(function(e){return!!e}))}return this._manifestQualityMap};e.prototype._updateDashlingState=function(){var e=this._dashling,t=this._context;e.settings.isABREnabled=t.isABREnabled();var i=this._getManifestVideoQualities();if(i){t.maxQuality(i[e.getMaxQuality(r)]);e.settings.isABREnabled?t.playingQuality(i[e.getPlayingQuality(r)]):t.playingQuality(i[e.getBufferingQuality(r)])}else t.maxQuality(0)};e.prototype._handleEnded=function(e){this._context.isPlaying(!1)};e.prototype._handleVolumeChanged=function(e){var t=this._videoElement;t&&this._context.volume(t.volume)};e.prototype._handlePlay=function(e){this._context.isPlaying(!0)};e.prototype._handlePause=function(e){this._context.isScrubbing()||this._context.isPlaying(!1)};e.prototype._handleWaiting=function(e){this._context.isLoading(!0)};e.prototype._handlePlaying=function(e){this._context.isLoading(!1);this._context.isSeeking(!1)};return e}(s.default);t.default=l});define("@ms/dashling/dist/amd/Dashling",["require","exports","./Settings","./StreamController","./DashlingEnums","./ManifestParser","./EventGroup"],function(e,t,i,s,n,o,a){var r=0,l=function(){function e(e){this.Event=n.DashlingEvent;this.SessionState=n.DashlingSessionState;this.RequestState=n.DashlingRequestState;this.isDisposed=!1;this._events=new a.default(this);this.settings=e||new i.default;this.reset()}e.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=!0;this._events.dispose();this.reset()}};e.prototype.addEventListener=function(e,t){this._events.on(this,e,t)};e.prototype.removeEventListener=function(e,t){this._events.off(this,e,t)};e.prototype.load=function(e,t){this.reset();this._sessionIndex=++r;this.startTime=(new Date).getTime();this._setState(n.DashlingSessionState.initializing);this.videoElement=e;this._initializeMediaSource(e);this._initializeManifest(t)};e.prototype.reset=function(){this.timeAtFirstCanPlay=null;this.startTime=null;this.lastError=null;if(this.streamController){this.streamController.dispose();this.streamController=null}if(this._parser){this._parser.dispose();this._parser=null}if(this.videoElement){this.settings.manifest=null;try{this.videoElement.pause()}catch(e){}this.videoElement=null}this._mediaSource=null;this._setState(n.DashlingSessionState.idle)};e.prototype.resetStreams=function(){this.streamController&&this.streamController.reset(!0,!0)};e.prototype.getRemainingBuffer=function(){return this.streamController?this.streamController.getRemainingBuffer():0};e.prototype.getBufferRate=function(){return this.streamController?this.streamController.getBufferRate():0};e.prototype.getPlayingQuality=function(e){return this.streamController?this.streamController.getPlayingQuality(e):this.settings.targetQuality[e]};e.prototype.getBufferingQuality=function(e){return this.streamController?this.streamController.getBufferingQuality(e):this.settings.targetQuality[e]};e.prototype.getMaxQuality=function(e){var t=this.settings.manifest?this.settings.manifest.streams[e]:null;return t?t.qualities.length-1:0};e.prototype._setState=function(e,t,i){if(!this.isDisposed&&this.state!==e){this.state=e;this.lastErrorType=t;this.lastErrorMessage=i;this.lastError=t?t+" "+(i?"("+i+")":""):null;e===n.DashlingSessionState.error&&this.streamController&&this.streamController.dispose();this.timeAtFirstCanPlay||e!=n.DashlingSessionState.playing&&e!=n.DashlingSessionState.paused||(this.timeAtFirstCanPlay=(new Date).getTime()-this.startTime);this._events.raise(n.DashlingEvent.sessionStateChange,{state:e,errorType:t,errorMessage:i});if(this.videoElement)switch(e){case n.DashlingSessionState.initializing:case n.DashlingSessionState.buffering:a.default.raise(this.videoElement,"waiting",null);break;case n.DashlingSessionState.playing:a.default.raise(this.videoElement,"playing",null);break;case n.DashlingSessionState.error:a.default.raise(this.videoElement,"error",null)}}};e.prototype._initializeMediaSource=function(e){var t,i=this,s=i._sessionIndex;try{t=new MediaSource}catch(e){i._setState(n.DashlingSessionState.error,n.DashlingError.mediaSourceInit)}if(t){t.addEventListener("sourceopen",function e(){t.removeEventListener("sourceopen",e);if(i._sessionIndex===s){i._mediaSource=t;i._tryStart()}},!1);e.src=URL.createObjectURL(t)}};e.prototype._initializeManifest=function(e){var i=this,s=this._sessionIndex,t=function(e){if(i._sessionIndex===s&&i.state!==n.DashlingSessionState.error){i.settings.manifest=e;i._tryStart()}};if(this.settings.manifest)t(this.settings.manifest);else{(this._parser=new o.default(this.settings)).parse(e,t,function(e,t){i._sessionIndex===s&&i._setState(n.DashlingSessionState.error,e,t)})}};e.prototype._tryStart=function(){var t=this;if(this.state!==n.DashlingSessionState.error&&this._mediaSource&&this.settings.manifest){this._mediaSource.duration=this.settings.manifest.mediaDuration;this.streamController=new s.default(this.videoElement,this._mediaSource,this.settings);this._events.on(this.streamController,n.DashlingEvent.sessionStateChange,function(e){t._setState(e.state,e.errorType,e.errorMessage)});this.streamController.start()}};return e}();t.default=l});define("@ms/dashling/dist/amd/Settings",["require","exports"],function(e,t){var i=function(){this.manifest=null;this.startTime=0;this.isABREnabled=!0;this.isRBREnabled=!1;this.targetQuality={audio:2,video:2};this.shouldAutoPlay=!0;this.logToConsole=!1;this.safeBufferSeconds=12;this.maxBufferSeconds=119.5;this.maxConcurrentRequests={audio:4,video:6};this.maxSegmentLeadCount={audio:1,video:5};this.defaultBandwidth=520;this.requestTimeout=3e4;this.maxRetries=3;this.delaysBetweenRetries=[200,1500,3e3];this.requestCacheThreshold=80;this.baseUrlOverride=null;this.preprocessRequest=null};t.default=i});define("@ms/dashling/dist/amd/StreamController",["require","exports","./EventGroup","./Async","./Stream","./MetricSet","./Utilities","./DashlingEnums"],function(e,t,o,a,u,r,c,p){var d;!function(e){e[e.closed=0]="closed";e[e.open=1]="open";e[e.ended=2]="ended"}(d||(d={}));var i=function(){function e(e,t,i){this._events=new o.default(this);this._async=new a.default(this);this._mediaSource=t;this._settings=i;this._bufferRate=new r.default(3);this._appendedSeconds=0;this._requestTimerIds=[0,0];this.streams=[];this._appendIndex=0;this._nextStreamIndex=0;this._appendIndex=0;this._audioDownloadIndex=0;this._videoDownloadIndex=0;this._simultaneousDownloadsPerStream=2;this._maxSegmentsAhead=2;this._nextRequestTimerId=0;this._seekingTimerId=0;this.stalls=0;this._lastCurrentTime=0;this._lastTimeBeforeSeek=0;this._startTime=0;this._videoElement=e;this._playbackMonitorId=0;this._canPlay=!0;this._timeAtStall=0;this._intializeVideoElement();this._initializeStreams(e,t,i);if(this.streams.length&&i&&i.startTime){var s=this.streams[0],n=s.fragments[0].time.lengthSeconds;this._appendIndex=Math.max(0,Math.min(s.fragments.length-1,Math.floor((i.startTime-.5)/n)))}}e.prototype.dispose=function(){var e=this;if(!e._isDisposed){e._isDisposed=!0;e._adjustPlaybackMonitor(!1);e._events.dispose();e._async.dispose();for(var t=0;e.streams&&t<e.streams.length;t++)e.streams[t].dispose();e._videoElement=null;e._mediaSource=null}};e.prototype.start=function(){this._startTime=(new Date).getTime();this._setCanPlay(!1);this._loadNextFragment();this._adjustPlaybackMonitor(!0)};e.prototype.getPlayingQuality=function(e){var t=0;if(!this._isDisposed)for(var i=0;i<this.streams.length;i++){var s=this.streams[i];if(s.streamType==e){var n=this._videoElement.currentTime,o=Math.min(s.fragments.length-1,Math.floor(n/s.fragments[0].time.lengthSeconds));t=0<=(t=s.fragments[o].qualityIndex)?t:s.qualityIndex;break}}return t};e.prototype.getBufferingQuality=function(e){var t=0;if(!this._isDisposed)for(var i=0,s=this.streams;i<s.length;i++){var n=s[i];if(n.streamType==e){t=n.qualityIndex;break}}return t};e.prototype.getBufferRate=function(){return this._bufferRate.average};e.prototype.getRemainingBuffer=function(e){var t=0;if(!this._isDisposed){var i=(this._settings.startTime||this._videoElement.currentTime)+(e||0),s=this._videoElement.buffered;!i&&0<s.length&&s.start(0)<1&&(i=s.start(0));for(var n=0;n<s.length;n++)if(i>=s.start(n)&&i<=s.end(n)){for(var o=s.end(n);++n<s.length&&s.start(n)-o<.06;)o=s.end(n);t=o-i;break}}return t};e.prototype.getTimeUntilUnderrun=function(e){var t=Number.MAX_VALUE,i=this;if(!i._isDisposed){var s=i._settings.startTime||Math.max(.5,i._videoElement.currentTime),n=i._settings.manifest.mediaDuration-s-.5,o=this.getRemainingBuffer(e),a=this.getBufferRate(),r=o/this._settings.safeBufferSeconds;r=Math.min(1,Math.max(0,r));if(o<n){(n<(t=o+r*(o*a))||t>.5*i._settings.maxBufferSeconds)&&(t=Number.MAX_VALUE)}}return t};e.prototype.reset=function(e,t){this._onThrottledSeek(!0)};e.prototype._intializeVideoElement=function(){var e=this,t=this._videoElement;t&&this._events.onAll(t,{seeking:e._onVideoSeeking,error:e._onVideoError,play:e._onPauseStateChange,pause:e._onPauseStateChange,ended:e._onVideoEnded,ratechange:e._onVideoRateChange})};e.prototype._initializeStreams=function(e,t,i){var s=this,n=i&&i.manifest&&i.manifest.streams?i.manifest.streams:null;s.streams=[];if(n){n.audio&&s.streams.push(new u.default("audio",t,e,i));n.video&&s.streams.push(new u.default("video",t,e,i))}for(var o=0,a=s.streams;o<a.length;o++){var r=a[o];s._events.on(r,p.DashlingEvent.download,l);s._events.on(r,p.DashlingEvent.sessionStateChange,d);r.initialize()}function l(e){s._events.raise(p.DashlingEvent.download,e)}function d(e){s._events.raise(p.DashlingEvent.sessionStateChange,e)}};e.prototype._loadNextFragment=function(){var i=this;if(!i._isDisposed){for(var e=i._getDownloadCandidates(),t=0;t<e.downloads.length;t++)for(var s=e.downloads[t],n=i.streams[t],o=0;o<s.length;o++){var a=s[o],r=(n.fragments[a],n.fragments[a-1]),l=r&&r.activeRequest&&r.activeRequest.state==p.DashlingRequestState.downloading?r.activeRequest:null,d=n.getRequestStaggerTime(),u=l?(new Date).getTime()-l.startTime:0;if(l&&!(d<=u)){c(t,d-u);break}n.load(a,function(){i._appendNextFragment()})}e.isAtMax&&c(0,300)}function c(e,t){if(!i._isDisposed){i._requestTimerIds[e]&&i._async.clearTimeout(i._requestTimerIds[e]);i._requestTimerIds[e]=i._async.setTimeout(function(){i._requestTimerIds[e]=0;i._loadNextFragment()},t)}}};e.prototype._appendNextFragment=function(){var e,t,i=this,s=this.streams;if(!i._isDisposed){var n=i._settings.startTime||i._videoElement.currentTime;if(s&&s.length&&i._mediaSource&&!i._isMediaSourceReadyState(i._mediaSource.readyState,d.closed)){for(;i._appendIndex<s[0].fragments.length;){var o=!0,a=!0;for(t=0;t<s.length;t++){e=s[t];o=o&&e.canAppend(i._appendIndex);a=a&&e.fragments[i._appendIndex].state===p.DashlingRequestState.appended&&!e.isMissing(i._appendIndex,n)}if(o){a=!1;for(t=0;t<s.length;t++){(e=s[t]).append(i._appendIndex,function(){i._appendNextFragment()});a=a&&e.fragments[i._appendIndex].state===p.DashlingRequestState.appended}}if(!a)break;var r=i.streams[0].fragments[i._appendIndex];if(!r.activeRequest._hasUpdatedBufferRate){r.activeRequest._hasUpdatedBufferRate=!0;i._appendedSeconds+=r.time.lengthSeconds;var l=((new Date).getTime()-this._startTime)/1e3;i._bufferRate.addMetric(i._appendedSeconds/(l||.1))}i._appendIndex++;if(i._settings.startTime)try{i._videoElement.currentTime=i._settings.startTime;i._settings.startTime=0}catch(e){}i._checkCanPlay()}i._appendIndex==s[0].fragments.length&&i._isMediaSourceReadyState(i._mediaSource.readyState,d.open)&&i._mediaSource.endOfStream();i._loadNextFragment()}}};e.prototype._adjustPlaybackMonitor=function(e){var t=this;if(!e&&t._playbackMonitorId){clearInterval(t._playbackMonitorId);t._playbackMonitorId=0}else e&&!t._playbackMonitorId&&(t._playbackMonitorId=setInterval(function(){t._checkCanPlay()},200))};e.prototype._checkCanPlay=function(){var t=this,e=t.getTimeUntilUnderrun();this._lastCurrentTime=t._videoElement.currentTime;if(t._canPlay&&e<.1&&!t._timeAtStall){t._timeAtStall=this._lastCurrentTime;t._async.setTimeout(function(){var e=t._timeAtStall;t._timeAtStall=0;if(!t._isDisposed&&t._videoElement.currentTime==e){t.stalls++;t._setCanPlay(!1)}},200)}if(!t._canPlay){if(t.streams[0].fragments[0].time.lengthSeconds<e&&1<t.getBufferRate()||e>t._settings.safeBufferSeconds)this._setCanPlay(!0);else if(t.getTimeUntilUnderrun(.5)>t._settings.safeBufferSeconds){t._videoElement.currentTime=Math.min(t._videoElement.currentTime+.5,t._videoElement.duration);this._setCanPlay(!0)}}this._events.raise(p.DashlingEvent.sessionStateChange,{state:this._canPlay?this._videoElement.paused?p.DashlingSessionState.paused:p.DashlingSessionState.playing:p.DashlingSessionState.buffering})};e.prototype._allStreamsAppended=function(e,t){for(var i=!1,s=0;s<e.length;s++){var n=e[s];i=i&&n.fragments[t]==p.DashlingRequestState.appended}return i};e.prototype._getDownloadCandidates=function(){var e=this,t=e._getCurrentFragmentRange(),i={downloads:[],isAtMax:!1},s=0;if(-1<t.start){e._ensureStreamsUpdated(t);var n=e._getMissingFragmentIndex(t);if(0<=n){t.start=Math.max(t.start,n);for(var o=0;o<e.streams.length;o++){var a=e.streams[o];i.downloads.push(e._getDownloadableIndexes(a,t));s+=i.downloads[i.downloads.length-1].length}}}i.isAtMax=!s&&0<=t.end&&t.end<e.streams[0].fragments.length-1;return i};e.prototype._getCurrentFragmentRange=function(){var e=this,t=e._videoElement,i=e._settings.manifest.mediaDuration,s={start:-1,end:-1};if(0<i){var n=e._settings.startTime||t.currentTime,o=i<=n+.005,a=e.streams[0],r=a.fragments.length,l=a.fragments[0].time.lengthSeconds;if(!o){.5<n&&(n-=.5);s.start=Math.max(0,Math.min(r-1,Math.floor(n/l)));s.end=Math.max(0,Math.min(r-1,Math.ceil((n+e._settings.maxBufferSeconds)/l)))}}return s};e.prototype._ensureStreamsUpdated=function(e){for(var t=this._videoElement.currentTime,i=0;i<this.streams.length;i++){var s=this.streams[i];s.assessQuality();for(var n=e.start;n<=e.end;n++)if(s.isMissing(n,t)){var o=s.fragments[n];c.default.log("Missing fragment reset: stream="+s.streamType+" index="+n+" ["+o.time.startSeconds+"]",this._settings);s.fragments[n].state=p.DashlingRequestState.idle}}};e.prototype._getMissingFragmentIndex=function(e){for(var t=e.start;t<=e.end;t++)for(var i=0;i<this.streams.length;i++){if(this.streams[i].fragments[t].state<=p.DashlingRequestState.idle)return t}return-1};e.prototype._getDownloadableIndexes=function(e,t){for(var i=[],s=Math.min(t.end,t.start+this._settings.maxSegmentLeadCount[e.streamType]),n=this._settings.maxConcurrentRequests[e.streamType]-e.getActiveRequestCount(),o=t.start;i.length<n&&o<=s;o++)e.fragments[o].state<=p.DashlingRequestState.idle&&i.push(o);return i};e.prototype._setCanPlay=function(e){if(this._canPlay!==e){this._canPlay=e;this._onVideoRateChange()}};e.prototype._onVideoSeeking=function(){this._lastTimeBeforeSeek||(this._lastTimeBeforeSeek=this._lastCurrentTime);this._seekingTimerId&&clearTimeout(this._seekingTimerId);this._setCanPlay(!1);this._settings.startTime=0;this._seekingTimerId=this._async.setTimeout(this._onThrottledSeek,300)};e.prototype._onThrottledSeek=function(e){var t=this;if(!t._isDisposed){var i=t._videoElement.currentTime,s=(this._lastTimeBeforeSeek,Math.floor(Math.max(0,i-.5)/t.streams[0].fragments[0].time.lengthSeconds)),n=1==t._videoElement.buffered.length&&t._videoElement.buffered.start(0)<=Math.max(0,i-2)&&t._videoElement.buffered.end(0)>i;c.default.log("Throttled seek: "+t._videoElement.currentTime,t._settings);t._seekingTimerId=0;t._lastTimeBeforeSeek=0;clearTimeout(t._nextRequestTimerId);t._nextRequestTimerId=0;var o=e||t._appendIndex<s,a=e||t._settings.manifest.mediaDuration>t._settings.maxBufferSeconds&&!n;t._appendIndex=s;c.default.log("Clearing buffer",this._settings);for(var r=0,l=this.streams;r<l.length;r++){var d=l[r];o&&d.abortAll();a&&d.clearBuffer()}this._appendNextFragment()}};e.prototype._onVideoError=function(){this._events.raise(p.DashlingEvent.sessionStateChange,{state:p.DashlingSessionState.error,errorType:p.DashlingError.videoElementError,errorMessage:c.default.getVideoError(this._videoElement)})};e.prototype._onPauseStateChange=function(){this._adjustPlaybackMonitor(!this._videoElement.paused);this._checkCanPlay()};e.prototype._onVideoEnded=function(){this._events.raise(p.DashlingEvent.sessionStateChange,{state:p.DashlingSessionState.paused})};e.prototype._onVideoRateChange=function(){var e=this._canPlay?1:0;this._videoElement.playbackRate!=e&&(this._videoElement.playbackRate=this._videoElement.defaultPlaybackRate=e)};e.prototype._isMediaSourceReadyState=function(e,t){return e===t||e===d[t]};return e}();t.default=i});define("@ms/dashling/dist/amd/EventGroup",["require","exports"],function(e,t){var i=function(){function p(e){this._id=p._uniqueId++;this._parent=e;this._eventRecords=[]}p.raise=function(e,t,i,s){var n;if(p._isElement(e)){if(document.createEvent){var o=document.createEvent("HTMLEvents");o.initEvent(t,s,!0);o.args=i;n=e.dispatchEvent(o)}else if(document.createEventObject){var a=document.createEventObject(i);e.fireEvent("on"+t,a)}}else for(;e&&!1!==n;){var r=e.__events__?e.__events__[t]:null;for(var l in r)for(var d=r[l],u=0;!1!==n&&u<d.length;u++){var c=d[u];n=c.callback.call(c.parent,i)}e=s?e.parent:null}return n};p.isObserved=function(e,t){return!!(e&&e.__events__&&e.__events__[t])};p.isDeclared=function(e,t){return!!(e&&e.__declaredEvents&&e.__declaredEvents[t])};p.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0};p._isElement=function(e){return!!e&&(e instanceof HTMLElement||e.dispatchEvent&&e.addEventListener)};p.prototype.dispose=function(){this.off();this._parent=null};p.prototype.onAll=function(e,t,i){for(var s in t)this.on(e,s,t[s],i)};p.prototype.on=function(e,t,i,s){if(-1<t.indexOf(","))for(var n=t.split(/[ ,]+/),o=0;o<n.length;o++)this.on(e,n[o],i,s);else{var a=this._parent,r={target:e,eventName:t,parent:a,callback:i,elementCallback:null,useCapture:s};e.__events__=e.__events__||{};e.__events__[t]=e.__events__[t]||{count:0};e.__events__[t][this._id]=e.__events__[t][this._id]||[];e.__events__[t][this._id].push(r);e.__events__[t].count++;function l(){try{var e=i.apply(a,arguments);if(!1===e&&arguments[0]&&arguments[0].preventDefault){var t=arguments[0];t.preventDefault();t.cancelBubble=!0}}catch(t){}return e}if(p._isElement(e)){r.elementCallback=l;e.addEventListener?e.addEventListener(t,l,s):e.attachEvent&&e.attachEvent("on"+t,l)}this._eventRecords.push(r)}};p.prototype.off=function(e,t,i,s){for(var n=0;n<this._eventRecords.length;n++){var o=this._eventRecords[n];if(!(e&&e!==o.target||t&&t!==o.eventName||i&&i!==o.callback||"boolean"==typeof s&&s!==o.useCapture)){var a=o.target.__events__[o.eventName],r=a?a[this._id]:null;if(r){if(1!==r.length&&i){a.count--;r.splice(r.indexOf(o),1)}else{a.count-=r.length;delete o.target.__events__[o.eventName][this._id]}a.count||delete o.target.__events__[o.eventName]}o.elementCallback&&(o.target.removeEventListener?o.target.removeEventListener(o.eventName,o.elementCallback,o.useCapture):o.target.detachEvent&&o.target.detachEvent("on"+o.eventName,o.elementCallback));this._eventRecords.splice(n--,1)}}};p.prototype.raise=function(e,t,i){return p.raise(this._parent,e,t,i)};p.prototype.declare=function(e){var t=this._parent.__declaredEvents=this._parent.__declaredEvents||{};if("string"==typeof e)t[e]=!0;else for(var i=0;i<e.length;i++)t[e[i]]=!0};p._uniqueId=0;return p}();t.default=i});define("@ms/dashling/dist/amd/Async",["require","exports"],function(e,t){var i=function(){function e(e){this._parent=e;this._throttleIds={};this._timeoutIds={}}e.prototype.dispose=function(){if(!this._isDisposed){this._isDisposed=!0;this.clearAllThrottles();this.clearAllTimeouts()}};e.prototype.setTimeout=function(e,t){var i,s=this;(i=setTimeout(function(){delete s._timeoutIds[i];i=0;e.apply(s._parent)},t))&&(this._timeoutIds[i]=!0);return i};e.prototype.clearTimeout=function(e){clearTimeout(e);delete this._timeoutIds[e]};e.prototype.clearAllTimeouts=function(){for(var e in this._timeoutIds)clearTimeout(e);this._timeoutIds={}};e.prototype.throttle=function(e,t,i,s,n){var o=this;s&&this.clearThrottle(t);if(!this._throttleIds[t]){this._throttleIds[t]=setTimeout(function(){n||e.apply(o._parent);delete o._throttleIds[t]},i);if(n){n=!1;e.apply(this._parent)}}};e.prototype.clearThrottle=function(e){if(this._throttleIds){clearTimeout(this._throttleIds[e]);delete this._throttleIds[e]}};e.prototype.clearAllThrottles=function(){if(this._throttleIds){for(var e in this._throttleIds)clearTimeout(this._throttleIds[e]);this._throttleIds=null}};return e}();t.default=i});define("@ms/dashling/dist/amd/Stream",["require","exports","./RequestManager","./Request","./EventGroup","./Utilities","./Async","./MetricSet","./Storage","./DashlingEnums"],function(e,t,d,r,u,c,p,h,m,f){var g="bytesPerSecond",i=function(){function e(e,t,i,s){var n=this,o=s.manifest.streams[e],a=o.timeline.length;n._events=new u.default(n);n._async=new p.default(n);n._storage=new m.default("Dashling.Stream.");n.fragments=[];n.streamType=e;n.qualityIndex=Math.max(0,Math.min(o.qualities.length-1,s.targetQuality[e]));n.bufferRate=new h.default(5);n._startTime=(new Date).getTime();n._appendLength=0;n._appendTimeoutId=0;n._initializedQualityIndex=-1;n._initRequestManager=new d.default(s);n.requestManager=new d.default(s);n._mediaSource=t;n._videoElement=i;n._settings=s;n._manifest=s.manifest;n._streamInfo=o;n._buffer=null;n._hasInitializedBuffer=!1;n._initSegments=[];for(var r=0;r<a;r++)n.fragments.push({state:f.DashlingRequestState.idle,qualityIndex:-1,qualityId:"",requestType:"media",fragmentIndex:r,time:o.timeline[r],activeRequest:null,requests:[]});var l=function(e){n._events.raise(f.DashlingEvent.download,e)};n._events.on(n.requestManager,f.DashlingEvent.download,l);n._events.on(n._initRequestManager,f.DashlingEvent.download,l)}e.prototype.dispose=function(){if(!this._isDisposed){this._isDisposed=!0;this._events.dispose();this._async.dispose();this.requestManager.dispose();this._initRequestManager.dispose()}};e.prototype.initialize=function(){var t=this._streamInfo.mimeType+";codecs="+this._streamInfo.codecs;if(!this._buffer)try{c.default.log("Creating "+t+" buffer",this._settings);this._buffer=this._mediaSource.addSourceBuffer(t)}catch(e){this._events.raise(f.DashlingEvent.sessionStateChange,{state:f.DashlingSessionState.error,errorType:f.DashlingError.sourceBufferInit,errorMessage:"type="+t+" error="+e})}};e.prototype.abortAll=function(){this._initRequestManager.abortAll();this.requestManager.abortAll()};e.prototype.clearBuffer=function(){clearTimeout(this._appendTimeoutId);this._isAppending=!1;this.abortAll();try{this._buffer.remove(0,this._videoElement.duration)}catch(e){}for(var e=0,t=this.fragments;e<t.length;e++){var i=t[e];i.state!==f.DashlingRequestState.downloaded&&(i.state=f.DashlingRequestState.idle)}};e.prototype.canAppend=function(e){var t=this.fragments[e],i=t?this._initSegments[t.qualityIndex]:null,s=this._initSegments[this._streamInfo.qualities.length-1];return t&&t.state==f.DashlingRequestState.downloaded&&i&&i.state>=f.DashlingRequestState.downloaded&&s&&s.state>=f.DashlingRequestState.downloaded};e.prototype.append=function(t,i){var s=this,n=s.fragments[t],e=s._streamInfo.qualities.length-1,o=[],a=s._buffer;if(!s._isAppending&&n&&n.state===f.DashlingRequestState.downloaded){s._isAppending=!0;n.state=f.DashlingRequestState.appending;if(!this._hasInitializedBuffer){this._hasInitializedBuffer=!0;e>n.qualityIndex&&o.push(s._initSegments[e])}o.push(s._initSegments[n.qualityIndex]);o.push(n.activeRequest);r()}function r(){if(!s._isDisposed)if(s._buffer.updating)s._appendTimeoutId=setTimeout(r,10);else{var e=o[0];if(o.length){a.addEventListener("update",l);try{c.default.log("Append started: "+s.streamType+" "+e.qualityId+" "+e.requestType+" "+(void 0!==e.fragmentIndex?"index "+e.fragmentIndex:""),s._settings);a.appendBuffer(e.data)}catch(e){if(e.code===DOMException.QUOTA_EXCEEDED_ERR){c.default.log("Append failed due to quota exception; trying again momentarily");a.removeEventListener("update",l);s._appendTimeoutId=setTimeout(r,500)}else d(f.DashlingError.sourceBufferAppendException,e)}}else s._appendTimeoutId=setTimeout(function(){if(!s._isDisposed){n.state=f.DashlingRequestState.appended;s._isAppending=!1;if(s.isMissing(t,s._videoElement.currentTime))d(f.DashlingError.sourceBufferAppendMissing,"Buffer missing appended fragment");else{var e=((new Date).getTime()-s._startTime)/1e3;s._appendLength+=n.time.lengthSeconds;s.bufferRate.addMetric(s._appendLength/e);i(n)}}},30)}}function l(){if(!s._isDisposed){var e=o[0];a.removeEventListener("update",l);e.timeAtAppended=(new Date).getTime()-e.startTime;e.state=f.DashlingRequestState.appended;e.clearDataAfterAppend&&(e.data=null);"init"===e.requestType&&(s._initializedQualityIndex=e.qualityIndex);c.default.log("Append complete: "+s.streamType+" "+e.qualityId+" "+e.requestType+" "+(void 0!==e.fragmentIndex?"index "+e.fragmentIndex:""),s._settings);o.shift();r()}}function d(e,t){var i="error="+(t=t||"")+" (quality="+n.qualityId+(void 0!==n.fragmentIndex?" index="+n.fragmentIndex:"")+")";n.state=f.DashlingRequestState.error;s._isAppending=!1;c.default.log("Append exception: "+i);s._events.raise(f.DashlingEvent.sessionStateChange,{state:f.DashlingSessionState.error,errorType:e,errorMessage:i})}};e.prototype.getBufferRate=function(){return this.bufferRate.average||0};e.prototype.getActiveRequestCount=function(){return this.requestManager.getActiveRequestCount()};e.prototype.getRequestStaggerTime=function(){return Math.round(1400*this._estimateDownloadSeconds(this.qualityIndex))};e.prototype.isMissing=function(e,t){return this.fragments[e].state==f.DashlingRequestState.appended&&!this.isBuffered(e,t)};e.prototype.isBuffered=function(e,t){var i=this.fragments[e],s=!1;if(i){var n=this._buffer.buffered,o=i.time,a=o.startSeconds<.3,r=o.startSeconds+o.lengthSeconds+.3>=this._manifest.mediaDuration,l=Math.max(t,o.startSeconds+(a?.8:.15)),d=o.startSeconds+o.lengthSeconds-(r?.8:.15);try{for(var u=0;u<n.length;u++)if(n.start(u)<=l&&n.end(u)>=d){s=!0;break}}catch(e){s=!0}}return s};e.prototype.canLoad=function(e){return this.fragments[e].state<=f.DashlingRequestState.idle};e.prototype.load=function(e,s){var t,n=this,o=this.fragments[e];if(o&&o.state<=f.DashlingRequestState.idle){o.state=f.DashlingRequestState.downloading;o.qualityIndex=n.qualityIndex;o.qualityId=this._streamInfo.qualities[o.qualityIndex].id;n._loadInitSegment(this.qualityIndex,s);t=new r.default({url:n._getUrl(e,o),fragmentIndex:e,requestType:"media",qualityIndex:o.qualityIndex,qualityId:o.qualityId,clearDataAfterAppend:!0,isArrayBuffer:!0,onSuccess:function(e){if(!n._isDisposed){o.state=f.DashlingRequestState.downloaded;var t=Math.round(e.timeAtLastByte-e.timeAtFirstByte),i=e.timeAtLastByte-t;c.default.log("Download complete: "+e.qualityId+" "+e.requestType+" index: "+e.fragmentIndex+" waiting: "+i+"ms receiving: "+t,n._settings);s()}},onError:function(e){if(!n._isDisposed)if(e.isAborted){o.state=f.DashlingRequestState.idle;o.activeRequest=null;o.requests=[]}else{o.state=f.DashlingRequestState.error;n._events.raise(f.DashlingEvent.sessionStateChange,{state:f.DashlingSessionState.error,errorType:f.DashlingError.mediaSegmentDownload,errorMessage:e.statusCode})}}},this._settings);o.activeRequest=t;o.requests.push(t);c.default.log("Download started: "+o.qualityId+" media index="+e+" time="+((new Date).getTime()-n._startTime)+"ms stagger="+n.getRequestStaggerTime()+"ms",n._settings);n.requestManager.start(t)}};e.prototype.assessQuality=function(){var e=this,t=e._settings,i=e.requestManager.getAverageBytesPerSecond(),s=e._streamInfo.qualities.length-1;i?"video"===this.streamType&&this._storage.setItem(g,String(i)):i=parseFloat(this._storage.getItem(g));if(t.isABREnabled&&i)if(t.isRBREnabled)e.qualityIndex=Math.round(Math.random()*s);else{for(var n=0,o="Quality check "+e.streamType+": bps="+Math.round(i),a=e._streamInfo.timeline[0].lengthSeconds,r=.4*a,l=0;l<=s;l++){var d=e._estimateDownloadSeconds(l,0);o+=" "+l+"="+d.toFixed(2)+"s";d+r<a&&(n=l)}e._async.throttle(function(){c.default.log(o,e._settings)},"assess",1e3,!1,!1);e.qualityIndex=n}else e.qualityIndex=Math.min(e._streamInfo.qualities.length-1,t.targetQuality[e.streamType])};e.prototype._estimateDownloadSeconds=function(e,t){var i=this._streamInfo.qualities[e],s=this._streamInfo.timeline[t||0].lengthSeconds,n=i.bandwidth/8*s,o=this.requestManager.getAverageBytesPerSecond();o?"video"===this.streamType&&this._storage.setItem(g,String(o)):o=parseFloat(this._storage.getItem(g));return n/(o||this._settings.defaultBandwidth)};e.prototype._loadInitSegment=function(e,t){var i,s=this,n=this._streamInfo.qualities.length-1,o=this._streamInfo.qualities[e].id,a="init";e!=n&&s._loadInitSegment(n,t);if(!s._initSegments[e]){i=s._initSegments[e]=new r.default({url:this._getInitUrl(e),state:f.DashlingRequestState.downloading,timeAtDownloadStarted:(new Date).getTime(),requestType:a,qualityIndex:e,qualityId:o,isArrayBuffer:!0,onSuccess:function(){if(!s._isDisposed){i.state=f.DashlingRequestState.downloaded;c.default.log("Download complete: "+s.streamType+" "+o+" "+a,s._settings);t(i)}},onError:function(){if(!s._isDisposed){i.state=f.DashlingRequestState.error;s._events.raise(f.DashlingEvent.sessionStateChange,{state:f.DashlingSessionState.error,errorType:f.DashlingError.initSegmentDownload,errorMessage:i.statusCode})}}},this._settings);c.default.log("Download started: "+s.streamType+" "+o+" "+a,s._settings);s._initRequestManager.start(i)}};e.prototype._getInitUrl=function(e){var t=this._streamInfo.initUrlFormat.replace("$RepresentationID$",this._streamInfo.qualities[e].id);return this._manifest.baseUrl+t};e.prototype._getUrl=function(e,t){var i=this._streamInfo.fragUrlFormat.replace("$RepresentationID$",t.qualityId).replace("$Time$",t.time.start);return this._manifest.baseUrl+i};return e}();t.default=i});define("@ms/dashling/dist/amd/RequestManager",["require","exports","./MetricSet","./Request","./DashlingEnums","./EventGroup"],function(e,t,i,s,n,o){var a=0,r=function(){function e(e){this._settings=e;this._events=new o.default(this);this._activeRequests={};this.waitTimes=new i.default(20);this.receiveTimes=new i.default(20);this.bytesPerSeconds=new i.default(20);this._activeRequestCount=0}e.prototype.dispose=function(){this.abortAll();this._events.dispose()};e.prototype.getActiveRequestCount=function(){return this._activeRequestCount};e.prototype.abortAll=function(){for(var e in this._activeRequests)this._activeRequests[e].dispose();this._events.off();this._activeRequests={}};e.prototype.start=function(e){var t=this;this._activeRequests[a++]=e;this._activeRequestCount++;this._events.on(e,s.default.BandwidthUpdateEvent,function(e){t.bytesPerSeconds.addMetric(e)});this._events.on(e,s.default.CompleteEvent,function(){t._activeRequestCount--;t._events.off(e);if(e.state===n.DashlingRequestState.downloaded){if(!(e.timeAtLastByte>t._settings.requestCacheThreshold)){t.waitTimes.addMetric(e.timeAtFirstByte);t.receiveTimes.addMetric(e.timeAtLastByte)}t._events.raise(n.DashlingEvent.download,e)}});e.start()};e.prototype.getAverageWait=function(){return this.waitTimes.average||0};e.prototype.getAverageReceive=function(){return this.receiveTimes.average||0};e.prototype.getAverageBytesPerSecond=function(){return this.bytesPerSeconds.average||0};return e}();t.default=r});define("@ms/dashling/dist/amd/MetricSet",["require","exports"],function(e,t){var i=function(){function e(e){this.metricValues=[];this.average=0;this._max=e}e.prototype.addMetric=function(e){this.average=this.average+(e-this.average)/(this.metricValues.length+1);this.metricValues.push(e);for(;this.metricValues.length>this._max;)this._removeFirstMetric();this.min=Math.min(e,this.min);this.max=Math.max(e,this.max)};e.prototype.reset=function(){this.metricValues=[];this.average=this.min=this.max=0};e.prototype._removeFirstMetric=function(){var e=this.metricValues.shift();this.average;this.average=this.average+(this.average-e)/this.metricValues.length};return e}();t.default=i});define("@ms/dashling/dist/amd/Request",["require","exports","./DashlingEnums","./EventGroup"],function(e,t,l,i){var s=function(){function r(e,t){this._options=e;this._settings=t;this.state=l.DashlingRequestState.idle;this.data=null;this.timeAtFirstByte=-1;this.timeAtLastByte=-1;this.statusCode="";this.progressEvents=[];this.bytesLoaded=0;this.bytesPerMillisecond=0;this.requestType=e.requestType;this.fragmentIndex=e.fragmentIndex;this.qualityIndex=e.qualityIndex;this.qualityId=e.qualityId;this.clearDataAfterAppend=e.clearDataAfterAppend;this._events=new i.default(this);this.isAborted=!1;this._requestAttempt=0;this._xhrType=XMLHttpRequest}r.prototype.dispose=function(){if(!this._isDisposed){this._isDisposed=!0;if(this._xhr){if(this.state===l.DashlingRequestState.downloading){this.state=l.DashlingRequestState.aborted;this.isAborted=!0;this._xhr.abort();this._options.onError&&this._options.onError(this);this._events.raise(r.CompleteEvent,this)}this._xhr=null}if(this._retryTimeoutId){clearTimeout(this._retryTimeoutId);this._retryTimeoutId=null}this._events.dispose();this._events=null}};r.prototype.start=function(){var t=this,e=this._options,i=e.url,s=e.isArrayBuffer,n=this._xhr=new this._xhrType;this._settings.preprocessRequest&&(i=this._settings.preprocessRequest(i));var o=this.startTime=(new Date).getTime();this._requestAttempt++;n.open("GET",i,!0);s&&(n.responseType="arraybuffer");n.timeout=this._settings.requestTimeout;n.onreadystatechange=function(){!t._isDisposed&&0<n.readyState&&t.timeAtFirstByte<0&&(t.timeAtFirstByte=(new Date).getTime()-o)};n.onprogress=function(e){if(!t._isDisposed){t.progressEvents.push({timeFromStart:(new Date).getTime()-o,bytesLoaded:e.lengthComputable?e.loaded:-1});t._postProgress()}};n.onloadend=function(){t._isDisposed||t._processResult()};this.state=l.DashlingRequestState.downloading;n.send()};r.prototype._processResult=function(){var e=this._xhr,t=this.progressEvents,i=this._options.isArrayBuffer;this._xhr=null;this.timeAtLastByte=(new Date).getTime()-this.startTime;if(200<=e.status&&e.status<=299){this.bytesLoaded=i?e.response.byteLength:e.responseText?e.responseText.length:0;e.onreadystatechange(null);this._postProgress(!0);if(2<t.length){var s=t[t.length-1],n=t[0],o=s.timeFromStart-n.timeFromStart,a=s.bytesLoaded-n.bytesLoaded;this.bytesPerMillisecond=a/o;this.timeAtFirstByte=this.timeAtLastByte-this.bytesLoaded/this.bytesPerMillisecond}this.data=i?new Uint8Array(e.response):e.responseText;this.statusCode=String(e.status);this.state=l.DashlingRequestState.downloaded;this._events.raise(r.CompleteEvent,this);this._options.onSuccess&&this._options.onSuccess(this)}else this._processError(e)};r.prototype._processError=function(e){var t=this,i=0===e.status&&this.timeAtLastByte>=this._settings.requestTimeout,s=!this.isAborted&&e.status<400&&406<e.status&&this._requestAttempt<this._settings.maxRetries,n=this._settings.delaysBetweenRetries;if(s){var o=n[this._requestAttempt-1]||n[n.length-1];this._retryTimeoutId=setTimeout(function(){t.start()},o)}else{var a=e.getResponseHeader("X-ErrorCode");this.state=l.DashlingRequestState.error;this.statusCode=this.isAborted?"aborted":i?"timeout":a||String(e.status);this._events.raise(r.CompleteEvent,this);this._options.onError&&this._options.onError(this)}};r.prototype._postProgress=function(e){var t=this.progressEvents;if(2<t.length){var i=t[t.length-1],s=t[0],n=i.bytesLoaded-s.bytesLoaded;if(1e4<n){var o=i.timeFromStart-s.timeFromStart;5<o&&this._events.raise(r.BandwidthUpdateEvent,1e3*n/o)}}};r.BandwidthUpdateEvent="bandwidthupdate";r.CompleteEvent="complete";return r}();t.default=s});define("@ms/dashling/dist/amd/DashlingEnums",["require","exports"],function(e,t){t.DashlingEvent={sessionStateChange:"sessionstatechange",download:"download"};t.DashlingError={mediaSourceInit:"mediaSourceInit",manifestDownload:"manifestDownload",initSegmentDownload:"initSegmentDownload",mediaSegmentDownload:"mediaSegmentDownload",manifestParse:"manifestParse",videoElementError:"videoElementError",sourceBufferInit:"sourceBufferInit",sourceBufferAppendException:"sourceBufferAppendException",sourceBufferAppendMissing:"sourceBufferAppendMissing"};!function(e){e[e.error=-1]="error";e[e.idle=0]="idle";e[e.initializing=1]="initializing";e[e.buffering=2]="buffering";e[e.playing=4]="playing";e[e.paused=5]="paused"}(t.DashlingSessionState||(t.DashlingSessionState={}));t.DashlingSessionState;!function(e){e[e.error=-1]="error";e[e.idle=0]="idle";e[e.downloading=1]="downloading";e[e.downloaded=2]="downloaded";e[e.appending=3]="appending";e[e.appended=4]="appended";e[e.aborted=5]="aborted"}(t.DashlingRequestState||(t.DashlingRequestState={}));t.DashlingRequestState;!function(e){e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED";e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK";e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE";e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED";e[e.MS_MEDIA_ERR_ENCRYPTED=5]="MS_MEDIA_ERR_ENCRYPTED"}(t.VideoElementError||(t.VideoElementError={}));t.VideoElementError});define("@ms/dashling/dist/amd/Utilities",["require","exports"],function(e,t){var i;!function(e){e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED";e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK";e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE";e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(i||(i={}));var s=function(){function e(){}e.bind=function(e,t){return function(){return t.apply(e,arguments)}};e.log=function(e,t){t&&!t.logToConsole||console.log(e)};e.getXmlNodeValue=function(e,t,i){var s=e.getElementsByTagName(t)[0],n=s?s.childNodes[0]:null;return n?n.nodeValue:i};e.getVideoBufferString=function(e){var t="";e=e||document.querySelector("video");for(var i=0;e&&i<e.buffered.length;i++)t+="["+e.buffered.start(i)+"-"+e.buffered.end(i)+"] ";return t};e.fromISOToSeconds=function(e){var t=0,i=e.substring(2),s=i.indexOf("H");if(-1<s){t+=60*Number(i.substring(0,s))*60;i=i.substring(s+1)}if(-1<(s=i.indexOf("M"))){t+=60*Number(i.substring(0,s));i=i.substring(s+1)}-1<(s=i.indexOf("S"))&&(t+=Number(i.substring(0,s)));return t};e.getVideoError=function(e){var t=e.error;return t?i[t.code]||String(t.code):null};return e}();t.default=s});define("@ms/dashling/dist/amd/Storage",["require","exports"],function(e,t){var i=function(){function e(e,t){this._prefix=e||"";this._useSessionStorage=!!t}e.prototype.getItem=function(e,t){var i=t;e=this._prefix+e;try{i=this._useSessionStorage?window.sessionStorage.getItem(e):window.localStorage.getItem(e)}catch(e){}return i};e.prototype.setItem=function(e,t){e=this._prefix+e;try{this._useSessionStorage?window.sessionStorage.setItem(e,t):window.localStorage.setItem(e,t)}catch(e){}};return e}();t.default=i});define("@ms/dashling/dist/amd/ManifestParser",["require","exports","./RequestManager","./Request","./EventGroup","./DashlingEnums","./Manifest"],function(e,t,s,a,n,r,l){var i=function(){function i(e){var t=this;this._events=new n.default(this);this._parseIndex=0;this._settings=e;this._requestManager=new s.default(e);this._events.on(this._requestManager,r.DashlingEvent.download,function(){t._events.raise(i.DownloadEvent)})}i.prototype.dispose=function(){if(this._requestManager){this._requestManager.dispose();this._requestManager=null}};i.prototype.parse=function(e,i,s){var t,n=this,o=++this._parseIndex;t=new a.default({url:e,requestType:"manifest",onSuccess:function(t){if(n._parseIndex===o){var e=new l.default(n._settings);try{e.parseFromRequest(t);i(e)}catch(e){"object"==typeof e&&(e.data=""+t.data);s(r.DashlingError.manifestParse,e)}}},onError:function(){n._parseIndex===o&&s(r.DashlingError.manifestDownload,t.statusCode)}},this._settings);this._requestManager.start(t)};i.DownloadEvent="download";return i}();t.default=i});define("@ms/dashling/dist/amd/Manifest",["require","exports","./Utilities"],function(e,t,b){var i=function(){function e(e){this._settings=e}e.prototype.parseFromRequest=function(e){this.request=e;this.parse(e.data)};e.prototype.parse=function(e){var t,i=(new DOMParser).parseFromString(e,"text/xml");this.baseUrl=this._settings.baseUrlOverride||b.default.getXmlNodeValue(i,"BaseURL","");this.mediaDuration=b.default.fromISOToSeconds(i.documentElement.getAttribute("mediaPresentationDuration"));this.streams={};for(var s=i.querySelectorAll("AdaptationSet"),n=0;n<s.length;n++){var o=s[n];if(o){var a=o.getAttribute("contentType"),r=o.querySelectorAll("Representation"),l=o.querySelector("SegmentTemplate"),d=o.querySelectorAll("S"),u=this.streams[a]={streamType:a,mimeType:o.getAttribute("mimeType"),codecs:o.getAttribute("codecs"),initUrlFormat:l.getAttribute("initialization"),fragUrlFormat:l.getAttribute("media"),qualities:[],timeline:[]},c=Number(l.getAttribute("timescale"));if(!d||!d.length)throw"Missing timeline";for(var p=0;p<r.length;p++){var h=r[p],m={id:h.getAttribute("id"),bandwidth:h.getAttribute("bandwidth"),width:0,height:0};if(h.getAttribute("height")){m.width=Number(h.getAttribute("width"));m.height=Number(h.getAttribute("height"))}u.qualities.push(m)}for(var f=0,g=0;g<d.length;g++){var _=d[g],v=Number(_.getAttribute("r"))||0,y=Number(_.getAttribute("d"));for(t=0;t<=v;t++){u.timeline.push({start:f,startSeconds:f/c,length:y,lengthSeconds:y/c});f+=y}}}}};return e}();t.default=i});define("odsp-next/controls/video/controls/canvas/FlashVideoContextBinding",["require","exports","tslib","knockout","@ms/odsp-shared/lib/bindings/base/BaseBinding","@ms/odsp-utilities/lib/browser/PlatformDetection","../../VideoPlayer.resx","../../VideoError","../../VideoErrorType","../../../../utilities/features/Features"],function(r,e,t,u,i,s,c,p,h,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="readystatechange",d=0,m=new s.default,f={},o=function(i){t.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.controlsDescendantBindings=!0;t._context=t.valueAccessor();t._isPlayerReady=u.observable(!1);t.subscribe(t._context.url,t._onUrlChanged);t.createBackgroundComputed(t._computeVolume);t.createBackgroundComputed(t._computeIsMuted);t.subscribe(t._context.seekPercentage,t.async.debounce(t._onSeekPercentageChanged,100));t.subscribe(t._context.isScrubbing,t._onIsScrubbingChanged);t.subscribe(t._context.isPlaying,t._onIsPlayingChanged);t._onUrlChanged();return t}e.prototype.dispose=function(){this._removeFlashPlayer();i.prototype.dispose.call(this)};e.prototype.handlePlaybackEvent=function(e,t){var i=this._playerElement;i||(i=this._playerElement=document.getElementById(this._playerId));this._isPlayerReady(!0);if(i)switch(e){case"onJavaScriptBridgeCreated":break;case"loadstart":this._context.isLoading(!0);this._loadTimeoutId=this.async.setTimeout(this._onLoadTimeout,1e4);break;case"error":this._context.setVideoStatus({statusMessage:c.strings.errorLoading,error:new p.default(h.default[h.default.flashOther],{type:h.default.flashOther})});break;case"emptied":this._context.canPlay(!0);break;case"durationchange":case"play":case"pause":break;case"loadedmetadata":this._loadTimeoutId&&this.async.clearTimeout(this._loadTimeoutId);this._context.canPlay(!0);break;case"seeking":this._context.isSeeking(!0);break;case"seeked":this._context.isSeeking(!1);this._context.isLoading(!1);break;case"timeupdate":this._loadTimeoutId&&this.async.clearTimeout(this._loadTimeoutId);this._context.position(t.currentTime);this._context.duration(t.duration);break;case"progress":var s=this._context.bufferedRanges,n=this._context.duration();if(n&&s){for(;s().length>t.buffered.length;)s.pop();for(var o=0;t.buffered&&o<t.buffered.length;o++){var a=s()[o],r=t.buffered._start[o],l=100*r/n+"%",d=100*(t.buffered._end[o]-r)/n+"%";if(a){a.left(l);a.width(d)}else s.push({left:u.observable(l),width:u.observable(d)})}}break;case"volumechange":break;case"complete":this._context.position(this._context.duration.peek());this._context.isPlaying(!1)}};e.prototype._onUrlChanged=function(){this._removeFlashPlayer();this._createFlashPlayer()};e.prototype._computeVolume=function(){var e=this._context.volume();if(this._isPlayerReady()&&this._playerElement)try{this._playerElement.setVolume(e)}catch(e){}};e.prototype._computeIsMuted=function(){var e=this._context.isMuted();if(this._isPlayerReady()&&this._playerElement)try{this._playerElement.setMuted(e)}catch(e){}};e.prototype._onSeekPercentageChanged=function(e){var t=this._context.duration();if(this._isPlayerReady()&&this._playerElement&&t&&!this._context.videoStatus().isVisible){try{this._playerElement.seek(e*t)}catch(e){}this._context.isSeeking(!0)}};e.prototype._onIsScrubbingChanged=function(e){this._onSeekPercentageChanged(this._context.seekPercentage())};e.prototype._onIsPlayingChanged=function(e){if(this._isPlayerReady()&&this._playerElement)try{e?this._playerElement.play2():this._playerElement.pause()}catch(e){}};e.prototype._createFlashPlayer=function(){if(this._context.url.peek()){var e,t;if("undefined"==typeof __webpack_public_path__){e="undefined"==typeof __webpack_public_path__?r.toUrl("odsp-media/flash/osmf.swf"):r("file-loader!odsp-media/flash/osmf.swf");t="undefined"==typeof __webpack_public_path__?r.toUrl("odsp-media/flash/strobe.swf"):r("file-loader!odsp-media/flash/strobe.swf")}else{e=r("file-loader!odsp-media/flash/osmf.swf");t=r("file-loader!odsp-media/flash/strobe.swf")}if(!l.isFeatureEnabled(l.UseFlashVideoPlayerFromManifest)){var i=window.FilesConfig.imgBaseUrl||"";if(i){e=i+"flash/v1/osmf.swf";t=i+"flash/v1/strobe.swf"}}var s="",n=this._context;this._playerId="player-"+ ++d;var o=this._playerId,a="javascriptCallbackFunction=flashVideoCallback&autoPlay="+!!(f[o]=this)._context.shouldAutoPlay+"&loop=false&controlBarMode=none&enableStageVideo=true&controlBarAutoHide=false&playButtonOverlay=false&id="+o+"&useHTML5=false&bufferingOverlay=false&src="+encodeURIComponent(n.url())+"&plugin_AdaptiveStreamingPlugin="+encodeURIComponent(e);s=m.isIE&&m.browserMajor<9?'<object id="'+o+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"><param name="movie" value="'+t+'" />':'<object id="'+o+'" name="'+o+'" type="application/x-shockwave-flash" data="'+t+'">';s+='<param name="allowfullscreen" value="false" /><param name="wmode" value="transparent" /><param name="bgcolor" value="000000"/><param name="allowscriptaccess" value="always"/><param name="flashvars" value="'+a+'" /></object>';this.element.innerHTML=s;this._playerElement=document.getElementById(o)}};e.prototype._removeFlashPlayer=function(){if(this._playerId){delete f[this._playerId];delete this._playerId;this._isPlayerReady(!1);var e=this._playerElement;this._playerElement=null;if(e)if(m.isIE){e.style.display="none";4===e.readyState?this._removeFlashPlayerIE(e):this.events.on(e,n,this._onIEFlashPlayerReadyStateChange)}else try{e.parentNode&&e.parentNode.removeChild(e)}catch(e){}}};e.prototype._removeFlashPlayerIE=function(e){for(var t in e)"function"==typeof e[t]&&(e[t]=null);e.parentNode&&e.parentNode.removeChild(e)};e.prototype._onIEFlashPlayerReadyStateChange=function(e){var t=e.target;if(4===t.readyState){this._removeFlashPlayerIE(t);this.events.off(t,n,this._onIEFlashPlayerReadyStateChange)}};e.prototype._onLoadTimeout=function(){this._context.setVideoStatus({statusMessage:c.strings.errorLoading,error:new p.default(h.default[h.default.flashLoadTimeout],{type:h.default.flashLoadTimeout})})};return e}(i.default);e.default=o;window.flashVideoCallback=function(e,t,i){f[e]&&f[e].handlePlaybackEvent(t,i)}});define("odsp-next/controls/video/controls/canvas/VideoMonitorBinding",["require","exports","tslib","@ms/odsp-shared/lib/bindings/base/BaseBinding","@ms/dashling/dist/amd/DashlingMonitor","./DashlingMonitor.css"],function(e,t,s,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(i){s.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.controlsDescendantBindings=!0;t._videoContext=t.valueAccessor();t.createBackgroundComputed(t._computeDashlingMonitor);return t}e.prototype.dispose=function(){i.prototype.dispose.call(this);this._disposeMonitor()};e.prototype._disposeMonitor=function(){if(this._dashlingMonitor){this._dashlingMonitor.dispose();this._dashlingMonitor=null;this.element.innerHTML=""}};e.prototype._computeDashlingMonitor=function(){var e=this._videoContext.dashling();this._disposeMonitor();if(e){this._dashlingMonitor=new n.default;this._dashlingMonitor.attachTo(this.element);this._dashlingMonitor.observe(e,e.videoElement)}};return e}(i.default);t.default=o});define("@ms/dashling/dist/amd/DashlingMonitor",["require","exports","./DashlingEnums"],function(e,t,m){var i=0,s=function(){function e(){this.id="DashMonitorView-"+i++;this._rowElements={};this._updateSeekBar=n(this,this._updateSeekBar);this._onSessionChanged=n(this,this._onSessionChanged);this.isActive=!1;this.isVisible=!0;this._dataContext=null;this.element=null;this.qualityContainer=null;this._metricCount=0;this._videoElement=null;this.reset()}e.prototype.dispose=function(){var e=this;if(e._interval){clearInterval(e._interval);e._interval=null}if(e._videoElement){e._videoElement.removeEventListener("timeupdate",e._updateSeekBar);e._videoElement.removeEventListener("seeking",e._updateSeekBar);e._videoElement=null}if(e._dashling){e._dashling.removeEventListener(e._dashling.Event.sessionStateChange,e._onSessionChanged);e._dashling=null}};e.prototype.attachTo=function(e){var t=d("div");t.innerHTML=this.renderHtml();this.element?e.replaceChild(t.firstChild,this.element):e.appendChild(t.firstChild);this.activate()};e.prototype.observe=function(e,t){var i=this;i.dispose();if(t){(i._videoElement=t).addEventListener("timeupdate",i._updateSeekBar);t.addEventListener("seeking",i._updateSeekBar)}if(e){(i._dashling=e).addEventListener(e.Event.sessionStateChange,i._onSessionChanged);i._onSessionChanged()}};e.prototype._onSessionChanged=function(){var e=this,t=e._dashling,i=t.state;if(i==m.DashlingSessionState.error||i==m.DashlingSessionState.idle){clearInterval(e._interval);e._interval=0;e.setDataContext(e._getStats(t))}else t.state>m.DashlingSessionState.idle&&!e._interval&&(e._interval=setInterval(function(){e.isVisible&&e.setDataContext(e._getStats(t))},100))};e.prototype.reset=function(){this._dataContext=this._createContext();this.element&&this.attachTo(this.element.parentElement)};e.prototype.setVisibility=function(e){if(e!=this.isVisible){this.isVisible=e;this.isActive&&this._update()}};e.prototype.setDataContext=function(e){this._dataContext=e;this._update()};e.prototype.renderHtml=function(){return'<div id="'+this.id+'" class="c-DashMonitor"><ul class="streamMetrics"></ul><div class="audio streamData"><span class="streamTitle">Audio</span><ul class="streamMetrics"></ul><div class="traffic"><div class="qualities"></div><div class="seekContainer"><div class="seekBar"></div></div></div></div><div class="video streamData"><span class="streamTitle">Video</span><ul class="streamMetrics"></ul><div class="traffic"><div class="qualities"></div><div class="seekContainer"><div class="seekBar"></div></div></div></div><div class="key"><div class="keyItem"><div class="keyBox waiting"></div><span>Waiting for response</span></div><div class="keyItem"><div class="keyBox downloading"></div><span>Receiving bytes</span></div><div class="keyItem"><div class="keyBox downloaded"></div><span>Downloaded</span></div><div class="keyItem"><div class="keyBox appending"></div><span>Appending</span></div><div class="keyItem"><div class="keyBox appended"></div><span>Appended</span></div><div class="keyItem"><div class="keyBox error"></div><span>Error</span></div></div>'};e.prototype.activate=function(){var e=this.element=r("#"+this.id);this.subElements={metrics:r(".streamMetrics",e),audioElement:r(".audio"),audioMetrics:r(".audio .streamMetrics",e),audioQualities:r(".audio .qualities",e),audioSeekBar:r(".audio .seekBar",e),videoElement:r(".video"),videoMetrics:r(".video .streamMetrics",e),videoQualities:r(".video .qualities",e),videoSeekBar:r(".video .seekBar",e),key:r(".key")};this.isActive=!0;this._update()};e.prototype.deactivate=function(){this.subElements=null;this.isActive=!1};e.prototype._updateSeekBar=function(){var e=this._videoElement;if(e){var t=100*e.currentTime/e.duration+"%";this.subElements.audioSeekBar.style.left=t;this.subElements.videoSeekBar.style.left=t}};e.prototype._update=function(){var e=this._dataContext,t=void 0!==e.state&&this._dashling&&e.state!==m.DashlingSessionState.idle;if(this.isActive){var i=this.subElements;u(this.element,"isVisible",t&&this.isVisible);this._updateMetrics(i.metrics,e.metrics);var s=e&&e.streams&&e.streams.audio||{},n=e&&e.streams&&e.streams.video||{};u(i.audioElement,"isVisible",!(!s.metrics&&!s.qualities));u(i.videoElement,"isVisible",!(!n.metrics&&!n.qualities));u(i.key,"isVisible",!(!s.qualities&&!n.qualities));this._updateMetrics(i.audioMetrics,s.metrics);this._updateQualities(i.audioQualities,s.qualities);this._updateMetrics(i.videoMetrics,n.metrics);this._updateQualities(i.videoQualities,n.qualities)}};e.prototype._updateMetrics=function(e,t){u(e,"isVisible",!!t);if(t)for(var i=e._metricLookup=e._metricLookup||{},s=0;s<t.length;s++){var n=t[s],o=i[n.title];if(!o){(o=d("li")).innerHTML='<span class="metricTitle">'+n.title+'</span><span class="metricValue"></span>';r(".metricTitle",o).textContent=n.title;e.appendChild(o);o=i[n.title]=r(".metricValue",o)}o.parentNode.className=void 0!==n.value&&null!==n.value&&""!==n.value?"hasValue":"";o.textContent=n.value}};e.prototype._updateQualities=function(e,t){u(e,"isVisible",!!t);if(t)for(var i=e._qualityRowLookup=e._qualityRowLookup||{},s=0;s<t.length;s++){var n=t[s];if(n){var o=i[s];if(!o){o=i[s]=d("div","row");d("div","rowHeader",n.title,o);d("div","rowFragments",null,o);o.qualityIndex=n.index;for(var a=0;a<e.childNodes.length;a++)if(n.index>Number(e.childNodes[a].qualityIndex)){e.insertBefore(o,e.childNodes[a]);break}o.parentNode||e.appendChild(o)}this._updateFragments(r(".rowFragments",o),n.fragments)}}};e.prototype._updateFragments=function(e,t){u(e,"isVisible",!!t);if(t){for(var i=e._fragmentListLookup=e._fragmentListLookup||{},s={},n=this._dataContext.duration,o=0;o<t.length;o++){var a=t[o],r=i[a.index];if(r)delete i[a.index];else{(r=d("div","rowRequest",null,e)).style.left=100*a.start/n+"%";r.style.width=100*a.length/n+"%"}(s[a.index]=r).className="rowRequest "+a.state}e._fragmentListLookup=s;for(var l in i)e.removeChild(i[l])}};e.prototype._createContext=function(){return{state:m.DashlingSessionState.idle,metrics:[],streams:{audio:null,video:null},duration:0}};e.prototype._getStats=function(e){var t=this._createContext(),i=e.streamController,s=e.settings.manifest;t.state=e.state;t.metrics.push({title:"State",value:m.DashlingSessionState[e.state]});t.metrics.push({title:"Last error",value:e.lastError});t.metrics.push({title:"Load",value:(e.timeAtFirstCanPlay?e.timeAtFirstCanPlay:(new Date).getTime()-e.startTime)+" ms"});if(s&&i){for(var n=[],o=0;o<i.streams.length;o++)n.push(i.streams[o].fragments);t.duration=s.mediaDuration;t.metrics.push({title:"Manifest",value:e.settings.manifest&&e.settings.manifest.request&&e.settings.manifest.request.timeAtLastByte?e.settings.manifest.request.timeAtLastByte+" ms":""});t.metrics.push({title:"Stalls",value:String(i.stalls)||""});t.metrics.push({title:"Recovery time",value:""});t.metrics.push({title:"Stall chance",value:""});t.metrics.push({title:"Buffer rate",value:g(e.getBufferRate(),2,2)+" s/s"});t.metrics.push({title:"Buffer left",value:g(e.getRemainingBuffer(),2,2)+" s"});var a=i?i.getTimeUntilUnderrun():0;t.metrics.push({title:"Time until stall",value:a<Number.MAX_VALUE?g(a,2,2)+" s":""});for(o=0;o<i.streams.length;o++){var r=i.streams[o],l={metrics:[],qualities:[]};(t.streams[r.streamType]=l).metrics.push({title:"Quality",value:String(r.qualityIndex)});var d=r.requestManager.getAverageWait();l.metrics.push({title:"Avg wait",value:d?g(d,2)+" ms":null});d=r.requestManager.getAverageReceive();l.metrics.push({title:"Avg receive",value:d?g(d,2)+" ms":null});d=r.requestManager.getAverageBytesPerSecond();l.metrics.push({title:"Avg bandwidth",value:d?_(d):null});for(var u=0;u<r.fragments.length;u++){var c=r.fragments[u];if(c.activeRequest){var p=l.qualities[c.qualityIndex];p||(p=l.qualities[c.qualityIndex]={title:c.qualityId,index:c.qualityIndex,fragments:[]});var h=f(c.state,this._dashling.RequestState);c.state==this._dashling.RequestState.downloading&&-1==c.activeRequest.timeAtFirstByte&&(h="waiting");p.fragments.push({index:u,state:h,start:c.time.startSeconds,length:c.time.lengthSeconds})}}}}return t};return e}();t.default=s;function r(e,t){return(t=t||document).querySelector(e)}function d(e,t,i,s){var n=document.createElement(e);t&&(n.className=t);i&&(n.textContent=i);s&&s.appendChild(n);return n}function f(e,t){for(var i in t)if(t[i]===e)return i;return""}function g(e,t,i){var s=String(parseFloat(e.toFixed(t)));if(i){-1==(s=""+s).indexOf(".")&&(s+=".");for(;s.indexOf(".")!=s.length-3;)s+="0"}return s}function _(e){var t=8*e;return t<1e3?t+" bps":t<1e6?g(t/1e3,2,2)+" kbps":g(t/1e6,2,2)+" mbps"}function u(e,t,i){var s,n=e.className.trim().split(" "),o={},a="";for(s=0;s<n.length;s++)n[s]&&(o[n[s]]=!0);(i=void 0===i?!o[t]:i)?o[t]=!0:delete o[t];for(var r in o)a+=r+" ";e.className=a.trim()}function n(e,t){return function(){return t.apply(e,arguments)}}});define("odsp-next/controls/video/controls/canvas/DashlingMonitor.css",["@microsoft/load-themed-styles","odsp-next/providers/theming/ThemeInitializer"],function(e,t){e.loadStyles([{rawString:".c-DashMonitor{background:rgba(44,44,44,.7);position:absolute;top:-10px;left:0;right:0;min-height:15px;display:block;opacity:0;color:#AAA}.c-DashMonitor.isVisible{transition:opacity .2s linear,top .25s ease-out;top:0;opacity:1}.c-DashMonitor .key,.c-DashMonitor .streamData{display:none}.c-DashMonitor .isVisible{display:block}.c-DashMonitor .streamMetrics{list-style-type:none;padding:5px 5px 0 5px;margin:0}.c-DashMonitor .streamMetrics li{margin-right:5px;margin-bottom:5px;border:1px solid rgba(255,255,255,.5);background:#313131;overflow:hidden;vertical-align:top;font-size:11px;display:none}.c-DashMonitor .streamMetrics li.hasValue{display:inline-block}.c-DashMonitor .streamTitle{font-size:15px;display:inline-block;width:80px;text-align:right;float:left;margin-right:5px;line-height:30px}.c-DashMonitor .metricTitle{padding:3px 5px;display:inline-block;font-weight:700}.c-DashMonitor .metricValue{display:inline-block;padding:3px 5px;white-space:nowrap;background:#5f5f5f;color:#fff}.c-DashMonitor .row{line-height:15px;height:15px;padding-bottom:1px;position:relative;border-top:1px solid rgba(255,255,255,.1);border-bottom:1px solid rgba(255,255,255,.1);margin-top:-1px;font-weight:700;font-size:9px;background:#222}.c-DashMonitor .traffic{position:relative}.c-DashMonitor .seekContainer{margin-left:3px}.c-DashMonitor .seekBar{position:absolute;top:0;left:0;width:2px;margin-left:-2px;background:rgba(255,255,255,.7);height:100%}.c-DashMonitor .rowHeader{position:absolute;width:80px;text-align:right}.c-DashMonitor .rowFragments,.c-DashMonitor .seekContainer{position:absolute;top:0;left:85px;right:0;bottom:0}.c-DashMonitor .rowRequest{position:absolute;top:2px;bottom:2px;border-radius:4px;box-shadow:inset -4px 0 7px 0 rgba(0,0,0,.6);min-width:5px}.c-DashMonitor .key{box-shadow:inset 0 8px 15px -10px rgba(0,0,0,.2);font-size:11px;padding:10px}.c-DashMonitor .keyItem{display:inline-block;margin-right:10px}.c-DashMonitor .keyBox{display:inline-block;position:relative;top:-1px;width:10px;height:10px;margin:0 5px;border:1px solid #888;vertical-align:middle}.c-DashMonitor .waiting{background:#adadad url(data:image/gif;base64,R0lGODlhBAAEAIAAANLS0paWliH/C05FVFNDQVBFMi4wAwEAAAAh+QQEBQAAACwAAAAABAAEAAACBkwAl2h5BQAh+QQEBQAAACwAAAAABAAEAAACBURiaLBZACH5BAQFAAAALAAAAAAEAAQAAAIGBBKXaHkFACH5BAQFAAAALAAAAAAEAAQAAAIFDGBosVkAOw==)}.c-DashMonitor .downloading{background:#727272 url(data:image/gif;base64,R0lGODlhBAAEAIAAADZn96m++yH/C05FVFNDQVBFMi4wAwEAAAAh+QQEBQAAACwAAAAABAAEAAACBgQSl2h5BQAh+QQEBQAAACwAAAAABAAEAAACBQxgaLFZACH5BAQFAAAALAAAAAAEAAQAAAIGTACXaHkFACH5BAQFAAAALAAAAAAEAAQAAAIFRGJosFkAOw==)}.c-DashMonitor .downloaded{background:#3747ff}.c-DashMonitor .appending{background:#85b98f}.c-DashMonitor .appended{background:#00bd24}.c-DashMonitor .error{background:#df4242}"}])});define("odsp-next/controls/video/controls/canvas/VideoCanvas.css",["@microsoft/load-themed-styles","odsp-next/providers/theming/ThemeInitializer"],function(e,t){e.loadStyles([{rawString:".od-VideoCanvas object,.od_videoCanvas video{position:absolute;left:0;top:0;width:100%;height:100%}"}])});define("odsp-next/controls/video/controls/canvas/VideoCanvas.html",[],function(){return'<div class=od-VideoCanvas>\x3c!--ko if: context.canvasType() === \'html\'--\x3e<div data-bind="htmlVideoContext: context"></div>\x3c!--/ko--\x3e\x3c!--ko if: context.canvasType() === \'flash\'--\x3e<div data-bind="flashVideoContext: context"></div>\x3c!--/ko--\x3e\x3c!--ko if: context.isDiagnosticsEnabled--\x3e<div data-bind="videoMonitor: context"></div>\x3c!--/ko--\x3e</div>'});define("odsp-next/controls/video/controls/playbackPanel/PlaybackPanel",["require","exports","@ms/odsp-shared/lib/utilities/knockout/ComponentFactory","./PlaybackPanelViewModel","./PlaybackPanel.html","./PlaybackPanel.css","../../../contextualMenu/ContextualMenu"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i.registerComponent({tagName:"od-playback-panel",template:e("./PlaybackPanel.html"),viewModel:s.default,synchronous:!0});t.default=n});define("odsp-next/controls/video/controls/playbackPanel/PlaybackPanelViewModel",["require","exports","tslib","knockout","@ms/odsp-shared/lib/base/ViewModel","office-ui-fabric-react/lib/Styling","../../../../bindings/keyboard/KeyboardBinding","../../../commands/CommandViewModel","../../../../bindings/contextMenu/ContextMenuAlignment","../../VideoPlayer.resx","../../../../bindings/dismiss/DismissBinding","../../actions/SetVideoQualityAction","../../actions/ToggleVideoABRAction","../../actions/ToggleVideoDiagnosticsAction","@ms/odsp-utilities/lib/string/TimeFormatter","../../resources/VideoResourceKeys","../scrubBar/ScrubBar","../volumeMenu/VolumeMenu"],function(e,t,i,n,s,o,a,r,l,d,u,c,p,h,m,f,g,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=function(s){i.__extends(e,s);function e(e){var t=s.call(this,e)||this;t.context=t.resources.consume(f.context);t.scrubBarComponent={name:g.default.tagName,params:{}};t.volumeMenuComponent={name:_.default.tagName,params:{}};t.addBindingHandlers({dismiss:u.default,keyboard:a.default});var i=t.observables;t.currentTime=i.pureCompute(t._computeCurrentTime);t.totalTime=i.pureCompute(t._computeTotalTime);t.percentVolume=i.pureCompute(t._computePercentVolume);t.showVolumeMenu=t.createObservable(!1);t.showContextMenu=t.createObservable(!1);t.contextualMenuParams=void 0;t.labels={fullScreenLabel:i.pureCompute(t._computeFullSreenLabel),gearLabel:d.strings.qualityMenuHeader,playPauseLabel:i.pureCompute(t._computePlayPauseLabel),volumeLabel:d.strings.volumeLabel};t.showFullScreen=i.pureCompute(t._computeShowFullScreen);t.playStateIcon=i.pureCompute(t._computePlayStateIcon);t.volumeStateIcon=i.pureCompute(t._computeVolumeStateIcon);t.maximizeStateIcon=i.pureCompute(t._computeMaximizeStateIcon);return t}e.prototype.onPlayToggleClicked=function(e,t){this.context.isPlaying(!this.context.isPlaying.peek());return!1};e.prototype.onGearClicked=function(e,t){if(!this.contextualMenuParams){var i=[new r.default({text:d.strings.qualityMenu1080,isToggleable:!0,action:new(this.managed(c.default))({quality:1080})}),new r.default({text:d.strings.qualityMenu720,isToggleable:!0,action:new(this.managed(c.default))({quality:720})}),new r.default({text:d.strings.qualityMenu480,isToggleable:!0,action:new(this.managed(c.default))({quality:480})}),new r.default({text:d.strings.qualityMenu360,isToggleable:!0,action:new(this.managed(c.default))({quality:360})}),new r.default({text:d.strings.qualityMenu240,isToggleable:!0,action:new(this.managed(c.default))({quality:240})}),new r.default({text:d.strings.qualityMenuAuto,isToggleable:!0,hasLineBreakBefore:!0,action:new(this.managed(p.default))})];this.context.canShowDiagnostics&&i.push(new r.default({text:"Show diagnostics",isToggleable:!0,action:new(this.managed(h.default))}));this.contextualMenuParams={items:n.observableArray(i),alignment:l.default.BottomCenter,allowHorizontalMenuNudging:!0,isOpen:this.showContextMenu,isBeakVisible:n.observable(!1),target:t.target,anchorElement:t.target}}this.showContextMenu(!this.showContextMenu.peek());return!1};e.prototype.onVolumeClicked=function(e,t){this.showVolumeMenu(!this.showVolumeMenu.peek());return!1};e.prototype.onMaximizedToggleClicked=function(e,t){this.context.isMaximized(!this.context.isMaximized.peek());return!1};e.prototype.getMuteButtonClass=function(){var e=this.context.volume();return this.context.isMuted()?"VolumeDisabled":0===e?"Volume0":e<=.3?"Volume1":e<=.6?"Volume2":"Volume3"};e.prototype._computeFullSreenLabel=function(){return this.context.isMaximized()?d.strings.exitFullScreenLabel:d.strings.fullScreenLabel};e.prototype._computePlayPauseLabel=function(){return this.context.isPlaying()?d.strings.pauseLabel:d.strings.playLabel};e.prototype._computeShowFullScreen=function(){return!!this.context.item().video};e.prototype._computeCurrentTime=function(){return m.formatTime(1e3*this.context.position())};e.prototype._computeTotalTime=function(){var e=1e3*this.context.duration();return isNaN(e)?"":m.formatTime(e)};e.prototype._computePercentVolume=function(){return Math.round(100*this.context.volume())+"%"};e.prototype._computePlayStateIcon=function(){return o.getIconClassName(this.context.isPlaying()?"Pause":"Play")};e.prototype._computeVolumeStateIcon=function(){return o.getIconClassName(this.getMuteButtonClass())};e.prototype._computeMaximizeStateIcon=function(){return o.getIconClassName(this.context.isMaximized()?"BackToWindow":"FullScreen")};return e}(s.default);t.default=v});define("odsp-next/controls/video/actions/SetVideoQualityAction",["require","exports","tslib","../../../base/BaseAction","@ms/odsp-utilities/lib/async/Promise","@ms/odsp-utilities/lib/logging/events/Qos.event","../resources/VideoResourceKeys"],function(e,t,s,i,n,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(i){s.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.name="SetVideoQuality";t._context=t.resources.consume(a.context);t._quality=e.quality;return t}e.prototype.onExecute=function(e,t){this._context.desiredQuality(this._quality);this._context.isABREnabled(!1);return n.default.wrap({resultType:o.ResultTypeEnum.Success})};e.prototype.onIsAvailable=function(){var e=this._context.maxQuality();return this._quality<=e};e.prototype.onIsToggled=function(){var e=this._context;return this._quality===(e.isABREnabled()?e.playingQuality():e.desiredQuality())};return e}(i.default);t.default=r});define("odsp-next/controls/video/actions/ToggleVideoABRAction",["require","exports","tslib","../../../base/BaseAction","@ms/odsp-utilities/lib/async/Promise","@ms/odsp-utilities/lib/logging/events/Qos.event","../resources/VideoResourceKeys"],function(e,t,i,s,n,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(t){i.__extends(e,t);function e(){var e=t.call(this,{})||this;e.name="ToggleVideoABR";e._context=e.resources.consume(a.context);return e}e.prototype.onExecute=function(e,t){var i=this._context.isABREnabled();i&&this._context.desiredQuality(this._context.playingQuality());this._context.isABREnabled(!i);return n.default.wrap({resultType:o.ResultTypeEnum.Success})};e.prototype.onIsToggled=function(){return this._context.isABREnabled()};return e}(s.default);t.default=r});define("odsp-next/controls/video/actions/ToggleVideoDiagnosticsAction",["require","exports","tslib","../../../base/BaseAction","@ms/odsp-utilities/lib/async/Promise","@ms/odsp-utilities/lib/logging/events/Qos.event","../resources/VideoResourceKeys"],function(e,t,i,s,n,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(t){i.__extends(e,t);function e(){var e=t.call(this,{})||this;e.name="ToggleVideoDiagnostics";e._context=e.resources.consume(a.context);return e}e.prototype.onExecute=function(e,t){this._context.isDiagnosticsEnabled(!this._context.isDiagnosticsEnabled());return n.default.wrap({resultType:o.ResultTypeEnum.Success})};e.prototype.onIsToggled=function(){return this._context.isDiagnosticsEnabled()};return e}(s.default);t.default=r});define("@ms/odsp-utilities/lib/string/TimeFormatter",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.formatTime=function(e){var t="",i=!1;if(36e5<=e){var s=Math.floor(e/36e5);e%=36e5;t+=s+":";i=!0}var n=Math.floor(e/6e4);e%=6e4;n<10&&i&&(t+="0");t+=n+":";var o=Math.floor(e/1e3);o<10&&(t+="0");return t+=o}});define("odsp-next/controls/video/controls/scrubBar/ScrubBar",["require","exports","@ms/odsp-shared/lib/utilities/knockout/ComponentFactory","./ScrubBarViewModel","./ScrubBar.html","./ScrubBar.css","../../../progressSpinnerFlat/ProgressSpinnerFlat"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i.registerComponent({tagName:"od-scrub-bar",template:e("./ScrubBar.html"),viewModel:s.default,synchronous:!0});t.default=n});define("odsp-next/controls/video/controls/scrubBar/ScrubBarViewModel",["require","exports","tslib","knockout","@ms/odsp-shared/lib/base/ViewModel","../../bindings/ScrubBinding","@ms/odsp-utilities/lib/string/TimeFormatter","../../../../bindings/keyboard/KeyboardBinding","../../resources/VideoResourceKeys"],function(e,t,s,n,i,o,a,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=function(i){s.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.context=t.resources.consume(l.context);t.addBindingHandlers({scrub:o.default,keyboard:r.default});t.percentPlayed=t.createPureComputed(t._computePercentPlayed);t.seekTooltipPercentage=n.observable(0);t.isHovering=n.observable(!1);t.isSeekTooltipVisible=t.createPureComputed(t._computeTooltipVisible);t.seekTooltipTime=t.createPureComputed(t._computeSeekTooltipTime);t.seekTooltipLeft=n.observable(0);return t}e.prototype.onLeftKey=function(){this.context.seekPercentage(Math.max(0,this.context.seekPercentage.peek()-.05));return!1};e.prototype.onRightKey=function(){this.context.seekPercentage(Math.min(1,this.context.seekPercentage.peek()+.05));return!1};e.prototype._computePercentPlayed=function(){return(this.context.isSeeking()||this.context.isScrubbing()?100*this.context.seekPercentage():100*this.context.position()/this.context.duration())+"%"};e.prototype._computeSeekTooltipTime=function(){return a.formatTime(1e3*this.context.duration()*this.seekTooltipPercentage())};e.prototype._computeTooltipVisible=function(){return this.context.duration()&&this.isHovering()};return e}(i.default);t.default=d});define("odsp-next/controls/video/bindings/ScrubBinding",["require","exports","tslib","@ms/odsp-shared/lib/bindings/base/BaseBinding"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(s){i.__extends(e,s);function e(e){var t=s.call(this,e)||this,i=e.valueAccessor();if((t._options=i).value||i.isScrubbing){t.events.on(t.element,"click",t._onMouseClick);t.events.on(t.element,"mousedown",t._onMouseDown);t.events.on(t.element,"touchstart",t._onTouchStart,!0)}(i.isHovering||i.isHovering||i.clientX)&&t.events.on(t.element,"mouseenter",t._onMouseEnter);return t}e.prototype._updateContainerRect=function(){var e=this.element.getBoundingClientRect();this._containerRect={left:e.left,top:e.top,width:e.width,height:e.height}};e.prototype._onTouchStart=function(e){e.touches&&e.touches.length&&this._onMouseDown(e.touches[0])};e.prototype._onTouchMove=function(e){e.touches&&e.touches.length&&this._onMouseMove(e.touches[0])};e.prototype._onMouseEnter=function(e){this._updateContainerRect();this.events.on(this.element,"mouseleave",this._onMouseLeave);this.events.on(window,"mousemove",this._onMouseMove);this.events.on(window,"touchmove",this._onTouchMove);this._onMouseMove(e);this._isHovering=!0};e.prototype._onMouseLeave=function(e){this._isHovering=!1;this.events.off(this.element,"mouseleave");if(!this._isScrubbing){this.events.off(window,"mousemove");this.events.off(window,"touchmove")}};e.prototype._onMouseDown=function(e){this._updateContainerRect();this.events.on(window,"mouseup",this._onMouseUp);this.events.on(window,"touchend",this._onMouseUp,!0);if(!this._isHovering){this.events.on(window,"mousemove",this._onMouseMove);this.events.on(window,"touchmove",this._onTouchMove,!0)}this._isScrubbing=!0;this._onMouseMove(e);return!1};e.prototype._onMouseMove=function(e){var t=e.clientX-this._containerRect.left,i=Math.min(1,Math.max(0,t/this._containerRect.width));this._hoverValue=i;this._clientX=t;this._isScrubbing&&(this._value=i);return!1};e.prototype._onMouseUp=function(){this.events.off(window,"mouseup");this.events.off(window,"touchend");this._isScrubbing=!1;if(!this._isHovering){this.events.off(window,"mousemove");this.events.off(window,"touchmove")}return!1};e.prototype._onMouseClick=function(e){this._onMouseDown(e);this._onMouseUp();return!1};Object.defineProperty(e.prototype,"_value",{set:function(e){this._options.value&&this._options.value(e)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_isScrubbing",{get:function(){return!!this._options.isScrubbing&&this._options.isScrubbing.peek()},set:function(e){this._options.isScrubbing&&this._options.isScrubbing(e)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_hoverValue",{set:function(e){this._options.hoverValue&&this._options.hoverValue(e)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_isHovering",{get:function(){return!!this._options.isHovering&&this._options.isHovering.peek()},set:function(e){this._options.isHovering&&this._options.isHovering(e)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_clientX",{set:function(e){this._options.clientX&&this._options.clientX(e)},enumerable:!0,configurable:!0});return e}(s.default);t.default=n});define("odsp-next/controls/video/controls/scrubBar/ScrubBar.html",[],function(){return'<div class=od-ScrubBar data-bind="keyboard: { mappings: { Left: onLeftKey, Right: onRightKey, preventDefault: true } }, css: { \'od-ScrubBar--isLoading\': context.isPlaying() && context.isLoading() }"><div data-bind="component: { name: \'ms-progressSpinnerFlat\' }"></div><div class=od-ScrubBar-bar tabindex=0 data-bind="scrub: { value: context.seekPercentage, hoverValue: seekTooltipPercentage, isScrubbing: context.isScrubbing, isHovering: isHovering, clientX: seekTooltipLeft }"><div class=od-ScrubBar-fill data-bind="foreach: context.bufferedRanges"><div class=od-ScrubBar-buffered data-bind="style: {left: left, width: width}"></div></div><div class=od-ScrubBar-scrubArea><div class=od-ScrubBar-thumb data-bind="style: { width: percentPlayed }"></div></div></div><div class=od-ScrubBar-tooltip data-bind="css: { \'od-ScrubBar-tooltip--isScrubbing\': isSeekTooltipVisible }, text: seekTooltipTime, style: { left: seekTooltipLeft() + \'px\' }"></div></div>'});define("odsp-next/controls/video/controls/scrubBar/ScrubBar.css",["@microsoft/load-themed-styles","odsp-next/providers/theming/ThemeInitializer"],function(e,t){e.loadStyles([{rawString:".od-ScrubBar{position:relative}.od-ScrubBar .ProgressSpinnerFlat{display:none}.od-ScrubBar--isLoading .ProgressSpinnerFlat{display:block;color:"},{theme:"white",defaultValue:"#ffffff"},{rawString:";position:absolute;left:0;right:0;bottom:4px}.od-ScrubBar-content{overflow:hidden;position:relative}.od-ScrubBar-bar{height:26px;position:relative;cursor:pointer}.od-ScrubBar-bar:focus{outline:1px solid transparent;box-shadow:0 0 0 1px #767676 inset}.od-ScrubBar-scrubArea{height:100%;position:relative}.od-ScrubBar-thumb{background-color:"},{theme:"themeDarkAlt",defaultValue:"#106ebe"},{rawString:";height:2px;position:absolute;top:12px;left:0}.od-ScrubBar-thumb::after{content:'';position:absolute;top:-10px;right:-11px;width:18px;height:18px;background-color:"},{theme:"neutralLight",defaultValue:"#eaeaea"},{rawString:";border-radius:50px;border:2px solid "},{theme:"themeDarkAlt",defaultValue:"#106ebe"},{rawString:"}.od-ScrubBar-fill{top:12px;width:100%;height:2px;position:absolute;background-color:"},{theme:"neutralLight",defaultValue:"#eaeaea"},{rawString:";box-shadow:0 0 1px rgba(255,255,255,.5);overflow:hidden;-webkit-mask-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC)}.od-ScrubBar-bar:hover .od-ScrubBar-fill::after{content:'';position:absolute;left:0;top:0;height:2px;right:0;background:rgba(255,255,255,.1)}.od-ScrubBar-buffered{position:absolute;left:0;top:0;height:2px;background-color:"},{theme:"neutralTertiary",defaultValue:"#a6a6a6"},{rawString:"}.od-ScrubBar-tooltip{position:absolute;pointer-events:none;min-width:30px;height:25px;line-height:25px;background:"},{theme:"white",defaultValue:"#ffffff"},{rawString:";color:"},{theme:"black",defaultValue:"#000000"},{rawString:";top:-22px;box-shadow:0 0 10px -3px;border-radius:1px;padding:0 8px;font-size:12px;text-align:center;-ms-transform:translate(-50%,50%);transform:translate(-50%,50%);opacity:0}.od-ScrubBar-tooltip--isScrubbing{transition:transform .2s ease-out,opacity .2s linear;-ms-transform:translate(-50%,0);transform:translate(-50%,0);opacity:1}.od-ScrubBar-tooltip:before{content:'';position:absolute;width:10px;height:10px;background:"},{theme:"white",defaultValue:"#ffffff"},{rawString:";bottom:-5px;left:50%;margin-left:-5px;-ms-transform:rotate(45deg);transform:rotate(45deg)}"}])});define("odsp-next/controls/video/controls/volumeMenu/VolumeMenu",["require","exports","@ms/odsp-shared/lib/utilities/knockout/ComponentFactory","./VolumeMenuViewModel","./VolumeMenu.html","./VolumeMenu.css"],function(e,t,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i.registerComponent({tagName:"od-volume-menu",template:e("./VolumeMenu.html"),viewModel:s.default,synchronous:!0});t.default=n});define("odsp-next/controls/video/controls/volumeMenu/VolumeMenuViewModel",["require","exports","tslib","@ms/odsp-shared/lib/base/ViewModel","office-ui-fabric-react/lib/Styling","../../../overlays/Overlay","../../../../bindings/dismiss/DismissBinding","../../bindings/ScrubBinding","../../VideoPlayer.resx","../../../../bindings/keyboard/KeyboardBinding","../../resources/VideoResourceKeys"],function(e,t,s,i,n,o,a,r,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(i){s.__extends(e,i);function e(e){var t=i.call(this,e)||this;t.overlayComponent={name:o.default.tagName,params:{alignToParent:!0}};t.context=t.resources.consume(u.context);t.addBindingHandlers({dismiss:a.default,scrub:r.default,keyboard:d.default});t.volume=t.createPureComputed(t._computeVolume);t.percentVolume=t.createPureComputed(t._computePercentVolume);t.volumeLabel=t.createComputed(t._computeVolumeLabel);t.icon=t.createPureComputed(t._computeIcon);return t}e.prototype.onLeftKey=function(){this.context.volume(Math.max(0,this.context.volume.peek()-.01));return!1};e.prototype.onRightKey=function(){this.context.volume(Math.min(1,this.context.volume.peek()+.01));return!1};e.prototype.onMuteToggleClicked=function(e,t){this.context.isMuted(!this.context.isMuted.peek());return!1};e.prototype.getMuteButtonClass=function(){var e=this.context.volume();return this.context.isMuted()?"VolumeDisabled":0===e?"Volume0":e<=.3?"Volume1":e<=.6?"Volume2":"Volume3"};e.prototype._computeVolume=function(){return Math.round(100*this.context.volume())};e.prototype._computePercentVolume=function(){return this.volume()+"%"};e.prototype._computeVolumeLabel=function(){return this.context.isMuted()?l.strings.unmuteTooltip:l.strings.muteTooltip};e.prototype._computeIcon=function(){return n.getIconClassName(this.getMuteButtonClass())};return e}(i.default);t.default=c});define("odsp-next/controls/video/controls/volumeMenu/VolumeMenu.html",[],function(){return'\x3c!--ko component: overlayComponent--\x3e<div role=slider class=od-VolumeMenu data-bind="keyboard: { mappings: { Left: onLeftKey, Right: onRightKey, preventDefault: true } }"><button class="od-VolumeMenu-button ms-Icon" data-bind="hasFocus: true, attr: { \'aria-label\': volumeLabel, }, class: icon, click: onMuteToggleClicked"></button><div class=od-VolumeMenu-bar tabindex=0 data-bind="scrub: { value: context.volume, isScrubbing: context.isAdjustingVolume }"><div class=od-VolumeMenu-scrubFill></div><div class=od-VolumeMenu-scrubArea><div class=od-VolumeMenu-scrubThumb data-bind="style: { width: percentVolume }"></div></div></div><div class=od-VolumeMenu-volume data-bind="text: volume"></div></div>\x3c!--/ko--\x3e'});define("odsp-next/controls/video/controls/volumeMenu/VolumeMenu.css",["@microsoft/load-themed-styles","odsp-next/providers/theming/ThemeInitializer"],function(e,t){e.loadStyles([{rawString:".od-VolumeMenu{width:310px;height:56px;position:absolute;top:-56px;border:1px solid "},{theme:"neutralTertiaryAlt",defaultValue:"#c8c8c8"},{rawString:";background-color:"},{theme:"white",defaultValue:"#ffffff"},{rawString:";opacity:.9}[dir=ltr] .od-VolumeMenu{left:-132px}[dir=rtl] .od-VolumeMenu{right:-132px}.od-VolumeMenu-button{width:40px;height:40px;margin:8px 4px;border:none;vertical-align:top;box-sizing:border-box;font-size:21px;color:"},{theme:"neutralPrimary",defaultValue:"#333333"},{rawString:";background-color:transparent;cursor:pointer}.od-VolumeMenu-button:hover{background-color:"},{theme:"neutralLight",defaultValue:"#eaeaea"},{rawString:"}.od-VolumeMenu-button:active{background-color:"},{theme:"neutralTertiaryAlt",defaultValue:"#c8c8c8"},{rawString:"}.od-VolumeMenu-volume{display:inline-block;vertical-align:top;line-height:58px;margin:0 8px;color:"},{theme:"neutralPrimary",defaultValue:"#333333"},{rawString:";width:26px}.od-VolumeMenu-bar{width:204px;height:30px;margin:13px 8px;display:inline-block;position:relative;cursor:pointer}.od-VolumeMenu-bar:focus{outline:1px solid transparent;box-shadow:0 0 0 1px #767676 inset}.od-VolumeMenu-scrubArea{height:100%;margin-right:10px;position:relative}.od-VolumeMenu-scrubThumb{background-color:"},{theme:"themeDarkAlt",defaultValue:"#106ebe"},{rawString:";height:10px;position:absolute;top:10px;left:0;border-radius:5px 0 0 5px;padding-left:5px}.od-VolumeMenu-scrubThumb::after{content:'';position:absolute;top:0;right:-5px;width:10px;height:10px;background-color:"},{theme:"neutralPrimary",defaultValue:"#333333"},{rawString:";border-radius:5px}.od-VolumeMenu-scrubFill{top:10px;width:100%;height:10px;position:absolute;background-color:"},{theme:"neutralTertiary",defaultValue:"#a6a6a6"},{rawString:";border-radius:5px;box-shadow:0 0 1px rgba(255,255,255,.5);overflow:hidden;-webkit-mask-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC)}.od-VolumeMenu-bar:hover .od-VolumeMenu-scrubFill::after{content:'';position:absolute;left:0;top:0;height:10px;right:0;background:rgba(255,255,255,.1);border-radius:5px}"}])});define("odsp-next/controls/video/controls/playbackPanel/PlaybackPanel.html",[],function(){return'<div class=od-PlaybackPanel>\x3c!--ko component: scrubBarComponent--\x3e\x3c!--/ko--\x3e<div class=od-PlaybackPanel-bottom><span class=od-PlaybackPanel-timePlayed data-bind="text: currentTime"></span> <span class=od-PlaybackPanel-buttons><button class="od-PlaybackPanel-button ms-Icon" data-bind="icon: true, click: onPlayToggleClicked, attr: { \'aria-label\': labels.playPauseLabel }, keyboard: { target: document, mappings: { Space: onPlayToggleClicked } }, class: playStateIcon"></button><div class=od-PlaybackPanel-volume data-bind="dismiss: { isOpen: showVolumeMenu }"><button class="od-PlaybackPanel-button ms-Icon" data-bind="icon: true, attr: { \'aria-label\': labels.volumeLabel }, class: volumeStateIcon, click: onVolumeClicked"></button>\x3c!--ko if: showVolumeMenu--\x3e<div class=od-PlaybackPanel-volumeMenu data-bind="component: volumeMenuComponent"></div>\x3c!--/ko--\x3e</div>\x3c!--ko if: showFullScreen--\x3e<button class="od-PlaybackPanel-button ms-Icon" data-bind="icon: true, attr: { \'aria-label\': labels.fullScreenLabel }, click: onMaximizedToggleClicked, keyboard: { target: document, mappings: { AltEnter: onMaximizedToggleClicked } }, class: maximizeStateIcon"></button>\x3c!--/ko--\x3e<div class=od-PlaybackPanel-gear data-bind="dismiss: { isOpen: showContextMenu }"><button class="od-PlaybackPanel-button ms-Icon ms-Icon--Settings" data-bind="icon: true, attr: { \'aria-label\': labels.gearLabel }, visible: context.canAdjustQuality, click: onGearClicked"></button>\x3c!--ko if: showContextMenu--\x3e<div class=od-PlaybackPanel-gearMenu data-bind="component: { name: \'ms-contextual-menu\', params: contextualMenuParams }"></div>\x3c!--/ko--\x3e</div></span> <span class=od-PlaybackPanel-totalTime data-bind="text: totalTime"></span></div></div>'});define("odsp-next/controls/video/controls/playbackPanel/PlaybackPanel.css",["@microsoft/load-themed-styles","odsp-next/providers/theming/ThemeInitializer"],function(e,t){e.loadStyles([{rawString:".od-VideoPanel{width:600px;height:400px;background:"},{theme:"black",defaultValue:"#000000"},{rawString:";position:relative}.od-PlaybackPanel{padding:0 28px;white-space:nowrap;background-color:rgba(255,255,255,.75)}.od-PlaybackPanel-bottom{position:relative;height:50px}.od-PlaybackPanel-timePlayed{float:left;color:"},{theme:"neutralPrimary",defaultValue:"#333333"},{rawString:";font-size:14px}.od-PlaybackPanel-totalTime{float:right;color:"},{theme:"neutralPrimary",defaultValue:"#333333"},{rawString:";font-size:14px}.od-PlaybackPanel-buttons{position:absolute;left:0;right:0;text-align:center}.od-PlaybackPanel-button{width:40px;height:40px;padding:0;margin:0 4px;border:none;box-sizing:border-box;font-size:21px;color:"},{theme:"neutralPrimary",defaultValue:"#333333"},{rawString:";background-color:transparent;cursor:pointer}.od-PlaybackPanel-button:hover{background-color:"},{theme:"neutralLight",defaultValue:"#eaeaea"},{rawString:"}.od-PlaybackPanel-button:active{background-color:"},{theme:"neutralTertiaryAlt",defaultValue:"#c8c8c8"},{rawString:"}.od-PlaybackPanel-volume{display:inline-block;position:relative}.od-PlaybackPanel-volumeMenu{position:absolute;top:0}.od-PlaybackPanel-gear{position:relative;display:inline}.od-PlaybackPanel-gearMenu{position:absolute;bottom:100%;margin-bottom:12px}[dir=ltr] .od-PlaybackPanel-gearMenu{left:50%}[dir=rtl] .od-PlaybackPanel-gearMenu{right:50%}.od-PlaybackPanel .ms-ContextualMenu{position:static}.md .od-PlaybackPanel-time,.sm .od-PlaybackPanel-time{width:40px}"}])});define("odsp-next/controls/oneUp/video/OneUpVideo.html",[],function(){return'\x3c!--ko if: showThumbnail--\x3e<div class=od-OneUpVideo-thumbnail data-bind="control: thumbnailControl, css: { \'od-OneUpVideo-thumbnail--framed\': showFrame }"></div>\x3c!--ko if: showWatermark--\x3e<img class=od-OneUpVideo-watermark data-bind="attr: { src: watermark, alt: watermarkAlt }">\x3c!--/ko--\x3e\x3c!--/ko--\x3e\x3c!--ko if: showVideo--\x3e<div class=od-OneUpVideo data-bind="component: { name: videoPlayerTagName, params: videoPlayerParams }"></div>\x3c!--/ko--\x3e'});define("odsp-next/controls/oneUp/video/OneUpVideo.css",["@microsoft/load-themed-styles","odsp-next/providers/theming/ThemeInitializer"],function(e,t){e.loadStyles([{rawString:".od-OneUpVideo-thumbnail--framed{display:block;width:200px;height:200px;background-color:"},{theme:"white",defaultValue:"#ffffff"},{rawString:";z-index:0;box-shadow:0 2px 6px 2px rgba(1,1,0,.05);position:absolute;left:50%;top:50%;-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.od-OneUpVideo-thumbnail--framed:after{content:'';display:block;position:absolute;top:0;left:0;bottom:0;right:0;border:2px solid "},{theme:"white",defaultValue:"#ffffff"},{rawString:"}.od-OneUpVideo-watermark{display:block;width:108px;height:108px;position:absolute;left:50%;top:50%;-ms-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}"}])});define("odsp-next/dataSources/videoItem/odc/VideoItemDataSource",["require","exports","@ms/odsp-datasources/lib/utilities/permissions/Identity","@ms/odsp-shared/lib/utilities/navigation/Navigation.key","@ms/odsp-utilities/lib/browser/PlatformDetection","@ms/odsp-utilities/lib/resources/Resources","@ms/odsp-utilities/lib/uri/Uri","../../../resources/DataSourceResourceKeys","../../../controls/video/VideoPlaybackType","../../../controls/video/VideoErrorType","../../../utilities/features/Features"],function(e,t,a,i,s,n,r,o,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=new s.default,p=function(){function e(e,t){this._downloadDataSource=t.downloadDataSource;this._identityDataSource=t.identityDataSource;this._navigation=t.navigation}e.prototype.isStreamingSupported=function(e){return!0};e.prototype.isHlsPlaybackSupported=function(){return!0};e.prototype.getErrorType=function(e,t){if("429"===e)return d.default.throttled;if("406"===e||"406"===t)return d.default.unsupportedCodec;var i="VideoProcessing_BitRateTooHigh";return e===i||t===i?d.default.bitRateTooHigh:d.default.unknown};e.prototype.getDownloadUrl=function(e,t){var i=this;return this._downloadDataSource.getDownloadUrl(e,{downloadType:2}).then(function(e){return i._buildVideoUrl(e,t)})};e.prototype.preprocessRequest=function(e,t){return t};e.prototype._buildVideoUrl=function(e,t){var i=!0;if(c.isAndroid&&c.browserMajor<4&&0===e.toLowerCase().indexOf("https:")){e="http"+e.substr(5);i=!1}e+="?";if(t===l.default.htmlDashling||t===l.default.flashDash){e+="&videoformat=dash&part=index";0}if(t===l.default.htmlDashling){e+="&pretranscode=0";e+="&transcodeahead=0"}else if(t===l.default.flashDash){e+="&pretranscode=0";e+="&.ism/manifest(format=mpd-time-csf)"}else if(t===l.default.htmlHls){e+="&videoformat=hls&part=index";0}if(u.isFeatureEnabled(u.EnableVideoManifestAuth)&&i){var s=new r.default(e),n=this._navigation.viewParams.authkey,o=this._identityDataSource;if(o.getIdentity().type!==a.IdentityType.anonymous)return o.getSessionToken().then(function(e){var t=e.accessToken;t&&s.setQueryParameter("access_token",t);return s.toString()});if(n){s.setQueryParameter("authkey",n);return s.toString()}}return e};return e}();t.default=p;t.resourceKey=n.createResolvedResourceKey(e("module").id,p,{downloadDataSource:o.download,identityDataSource:o.identity,navigation:i.navigation})});